/*! For license information please see 7112840a-0a09847fb5fd450c5358.js.LICENSE.txt */
"use strict";(self.webpackChunkgatsby_portfolio=self.webpackChunkgatsby_portfolio||[]).push([[16],{2040:function(e,t,n){n.d(t,{u7:function(){return xl},Jj:function(){return gc},IX:function(){return rc},my:function(){return js},xU:function(){return Jc},Lz:function(){return mc},WA:function(){return P},F8:function(){return wc},$q:function(){return Xc},W:function(){return $c},EK:function(){return $},PU:function(){return El},l7:function(){return Rs},Ky:function(){return be},Xb:function(){return oe},Cf:function(){return Us},K9:function(){return M},Me:function(){return ce},yq:function(){return C},Wi:function(){return Os},ET:function(){return Ol},Ab:function(){return Hl},vr:function(){return Ql},Fc:function(){return lc},hJ:function(){return Ws},B$:function(){return Ys},at:function(){return Gs},oe:function(){return Ml},AK:function(){return Gl},TF:function(){return dc},JU:function(){return Js},ST:function(){return oc},fH:function(){return sc},Ix:function(){return hc},Wu:function(){return ml},Lx:function(){return pl},qY:function(){return ac},GL:function(){return ql},QT:function(){return Nl},kl:function(){return Al},Xk:function(){return Dl},PL:function(){return Zl},UQ:function(){return Cl},zN:function(){return Ll},nP:function(){return Wl},b9:function(){return ll},vh:function(){return fl},Pb:function(){return vc},L$:function(){return yc},cf:function(){return Vl},sc:function(){return Pl},Xo:function(){return sl},IO:function(){return il},iE:function(){return $s},Eo:function(){return Xs},i3:function(){return zl},Bt:function(){return jl},pl:function(){return Rl},Ub:function(){return A},qK:function(){return tl},TQ:function(){return vl},e0:function(){return dl},r7:function(){return Fl},Mx:function(){return fc},ar:function(){return ul}});var r=n(2826),i=n(8052),a=n(885),u=n(5861),o=n(136),s=n(2963),c=n(1120),l=n(8664),f=n(2982),h=n(5671),d=n(3144),v=n(7757),y=n.n(v),p=n(5331),m=n(2324),g=n(999),k=n(5001),w=n(1337);function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var T="@firebase/firestore",E=function(){function e(t){(0,h.Z)(this,e),this.uid=t}return(0,d.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();E.UNAUTHENTICATED=new E(null),E.GOOGLE_CREDENTIALS=new E("google-credentials-uid"),E.FIRST_PARTY=new E("first-party-uid"),E.MOCK_USER=new E("mock-user");var S="9.1.3",N=new g.Yd("@firebase/firestore");function _(){return N.logLevel}function A(e){N.setLogLevel(e)}function D(e){if(N.logLevel<=g.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(L);N.debug.apply(N,["Firestore (".concat(S,"): ").concat(e)].concat((0,f.Z)(i)))}}function Z(e){if(N.logLevel<=g.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(L);N.error.apply(N,["Firestore (".concat(S,"): ").concat(e)].concat((0,f.Z)(i)))}}function C(e){if(N.logLevel<=g.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(L);N.warn.apply(N,["Firestore (".concat(S,"): ").concat(e)].concat((0,f.Z)(i)))}}function L(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(S,") INTERNAL ASSERTION FAILED: ")+e;throw Z(t),new Error(t)}function F(e,t){e||R()}function M(e,t){e||R()}function O(e,t){return e}var V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},P=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,r)).code=e,i.message=r,i.name="FirebaseError",i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return n}((0,l.Z)(Error)),q=function e(){var t=this;(0,h.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},U=function e(t,n){(0,h.Z)(this,e),this.user=n,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer ".concat(t)},B=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(E.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),K=function(){function e(t){(0,h.Z)(this,e),this.token=t,this.changeListener=null}return(0,d.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),z=function(){function e(t){(0,h.Z)(this,e),this.t=t,this.currentUser=E.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,d.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new q;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new q,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},s=function(e){D("FirebaseCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return s(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?s(e):(D("FirebaseCredentialsProvider","Auth not yet detected"),a.resolve(),a=new q)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(D("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(F("string"==typeof n.accessToken),new U(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return F(null===e||"string"==typeof e),new E(e)}}]),e}(),G=function(){function e(t,n,r){(0,h.Z)(this,e),this.h=t,this.l=n,this.m=r,this.type="FirstParty",this.user=E.FIRST_PARTY}return(0,d.Z)(e,[{key:"authHeaders",get:function(){var e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}]),e}(),j=function(){function e(t,n,r){(0,h.Z)(this,e),this.h=t,this.l=n,this.m=r}return(0,d.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new G(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(E.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),Q=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.g(e)},this.p=function(e){return n.writeSequenceNumber(e)})}return(0,d.Z)(e,[{key:"g",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.p&&this.p(e),e}}]),e}();function H(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}Q.T=-1;var W=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,null,[{key:"I",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=H(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function Y(e,t){return e<t?-1:e>t?1:0}function J(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function X(e){return e+"\0"}var $=function(){function e(t,n){if((0,h.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new P(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new P(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new P(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new P(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,d.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?Y(this.nanoseconds,e.nanoseconds):Y(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),ee=function(){function e(t){(0,h.Z)(this,e),this.timestamp=t}return(0,d.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new $(0,0))}}]),e}();function te(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ne(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function re(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var ie=function(){function e(t,n,r){(0,h.Z)(this,e),void 0===n?n=0:n>t.length&&R(),void 0===r?r=t.length-n:r>t.length-n&&R(),this.segments=t,this.offset=n,this.len=r}return(0,d.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),ae=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf("//")>=0)throw new P(V.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,(0,f.Z)(o.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(ie),ue=/^[_a-zA-Z][_a-zA-Z0-9]*$/,oe=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return ue.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new P(V.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},u=!1;i<e.length;){var o=e[i];if("\\"===o){if(i+1===e.length)throw new P(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new P(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===o?(u=!u,i++):"."!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new P(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(ie),se=function(){function e(t){(0,h.Z)(this,e),this.fields=t,t.sort(oe.comparator)}return(0,d.Z)(e,[{key:"covers",value:function(e){var t,n=b(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return J(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}]),e}();function ce(){return"undefined"!=typeof atob}var le=function(){function e(t){(0,h.Z)(this,e),this.binaryString=t}return(0,d.Z)(e,[{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return Y(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(t){return new e(atob(t))}},{key:"fromUint8Array",value:function(t){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(t);return new e(n)}}]),e}();le.EMPTY_BYTE_STRING=new le("");var fe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function he(e){if(F(!!e),"string"==typeof e){var t=0,n=fe.exec(e);if(F(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:de(e.seconds),nanos:de(e.nanos)}}function de(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ve(e){return"string"==typeof e?le.fromBase64String(e):le.fromUint8Array(e)}function ye(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pe(e){var t=e.mapValue.fields.__previous_value__;return ye(t)?pe(t):t}function me(e){var t=he(e.mapValue.fields.__local_write_time__.timestampValue);return new $(t.seconds,t.nanos)}function ge(e){return null==e}function ke(e){return 0===e&&1/e==-1/0}function we(e){return"number"==typeof e&&Number.isInteger(e)&&!ke(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var be=function(){function e(t){(0,h.Z)(this,e),this.path=t}return(0,d.Z)(e,[{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"isEqual",value:function(e){return null!==e&&0===ae.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(ae.fromString(t))}},{key:"fromName",value:function(t){return new e(ae.fromString(t).popFirst(5))}},{key:"comparator",value:function(e,t){return ae.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new ae(t.slice()))}}]),e}();function xe(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ye(e)?4:10:R()}function Ie(e,t){var n=xe(e);if(n!==xe(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return me(e).isEqual(me(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=he(e.timestampValue),r=he(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ve(e.bytesValue).isEqual(ve(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return de(e.geoPointValue.latitude)===de(t.geoPointValue.latitude)&&de(e.geoPointValue.longitude)===de(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return de(e.integerValue)===de(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=de(e.doubleValue),r=de(t.doubleValue);return n===r?ke(n)===ke(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return J(e.arrayValue.values||[],t.arrayValue.values||[],Ie);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(te(n)!==te(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ie(n[i],r[i])))return!1;return!0}(e,t);default:return R()}}function Te(e,t){return void 0!==(e.values||[]).find((function(e){return Ie(e,t)}))}function Ee(e,t){var n=xe(e),r=xe(t);if(n!==r)return Y(n,r);switch(n){case 0:return 0;case 1:return Y(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=de(e.integerValue||e.doubleValue),r=de(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Se(e.timestampValue,t.timestampValue);case 4:return Se(me(e),me(t));case 5:return Y(e.stringValue,t.stringValue);case 6:return function(e,t){var n=ve(e),r=ve(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=Y(n[i],r[i]);if(0!==a)return a}return Y(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=Y(de(e.latitude),de(t.latitude));return 0!==n?n:Y(de(e.longitude),de(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=Ee(n[i],r[i]);if(a)return a}return Y(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=Y(r[u],a[u]);if(0!==o)return o;var s=Ee(n[r[u]],i[a[u]]);if(0!==s)return s}return Y(r.length,a.length)}(e.mapValue,t.mapValue);default:throw R()}}function Se(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Y(e,t);var n=he(e),r=he(t),i=Y(n.seconds,r.seconds);return 0!==i?i:Y(n.nanos,r.nanos)}function Ne(e){return _e(e)}function _e(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=he(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ve(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,be.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=b(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=_e(a)}}catch(u){i.e(u)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,i=b(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+="".concat(a,":").concat(_e(e.fields[a]))}}catch(u){i.e(u)}finally{i.f()}return n+"}"}(e.mapValue):R();var t,n}function Ae(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function De(e){return!!e&&"integerValue"in e}function Ze(e){return!!e&&"arrayValue"in e}function Ce(e){return!!e&&"nullValue"in e}function Le(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Re(e){return!!e&&"mapValue"in e}function Fe(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return ne(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Fe(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Fe(e.arrayValue.values[r]);return n}return Object.assign({},e)}var Me=function(){function e(t){(0,h.Z)(this,e),this.value=t}return(0,d.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Re(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fe(t)}},{key:"setAll",value:function(e){var t=this,n=oe.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Fe(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Re(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Ie(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Re(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){ne(t,(function(t,n){return e[t]=n}));var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:"clone",value:function(){return new e(Fe(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Oe(e){var t=[];return ne(e.fields,(function(e,n){var r=new oe([e]);if(Re(n)){var i=Oe(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=b(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;t.push(r.child(o))}}catch(s){u.e(s)}finally{u.f()}}}else t.push(r)})),new se(t)}var Ve=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=a}return(0,d.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Me.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Me.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"clone",value:function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,ee.min(),Me.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,Me.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,Me.empty(),2)}}]),e}(),Pe=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,h.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.A=null};function qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Pe(e,t,n,r,i,a,u)}function Ue(e){var t=O(e);if(null===t.A){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return function(e){return e.field.canonicalString()+e.op.toString()+Ne(e.value)}(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),ge(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=et(t.startAt)),t.endAt&&(n+="|ub:",n+=et(t.endAt)),t.A=n}return t.A}function Be(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!nt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!Ie(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!it(e.startAt,t.startAt)&&it(e.endAt,t.endAt)}function Ke(e){return be.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var ze=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.P(Ee(t,this.value)):null!==t&&xe(this.value)===xe(t)&&this.P(Ee(t,this.value))}},{key:"P",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return R()}}},{key:"v",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,r):new Ge(e,t,r):"array-contains"===t?new We(e,r):"in"===t?new Ye(e,r):"not-in"===t?new Je(e,r):"array-contains-any"===t?new Xe(e,r):new n(e,t,r)}},{key:"R",value:function(e,t,n){return"in"===t?new je(e,n):new Qe(e,n)}}]),n}(function(){return function e(){(0,h.Z)(this,e)}}());var Ge=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,i)).key=be.fromName(i.referenceValue),a}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=be.comparator(e.key,this.key);return this.P(t)}}]),n}(ze),je=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,"in",r)).keys=He("in",r),i}return(0,d.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(ze),Qe=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=He("not-in",r),i}return(0,d.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(ze);function He(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return be.fromName(e.referenceValue)}))}var We=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return Ze(t)&&Te(t.arrayValue,this.value)}}]),n}(ze),Ye=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"in",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&Te(this.value.arrayValue,t)}}]),n}(ze),Je=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"not-in",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){if(Te(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Te(this.value.arrayValue,t)}}]),n}(ze),Xe=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!Ze(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return Te(t.value.arrayValue,e)}))}}]),n}(ze),$e=function e(t,n){(0,h.Z)(this,e),this.position=t,this.before=n};function et(e){return"".concat(e.before?"b":"a",":").concat(e.position.map((function(e){return Ne(e)})).join(","))}var tt=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,h.Z)(this,e),this.field=t,this.dir=n};function nt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function rt(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?be.comparator(be.fromName(u.referenceValue),n.key):Ee(u,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function it(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Ie(e.position[n],t.position[n]))return!1;return!0}var at=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,h.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=s,this.V=null,this.S=null,this.startAt,this.endAt};function ut(e,t,n,r,i,a,u,o){return new at(e,t,n,r,i,a,u,o)}function ot(e){return new at(e)}function st(e){return!ge(e.limit)&&"F"===e.limitType}function ct(e){return!ge(e.limit)&&"L"===e.limitType}function lt(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function ft(e){var t,n=b(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.v())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function ht(e){return null!==e.collectionGroup}function dt(e){var t=O(e);if(null===t.V){t.V=[];var n=ft(t),r=lt(t);if(null!==n&&null===r)n.isKeyField()||t.V.push(new tt(n)),t.V.push(new tt(oe.keyField(),"asc"));else{var i,a=!1,u=b(t.explicitOrderBy);try{for(u.s();!(i=u.n()).done;){var o=i.value;t.V.push(o),o.field.isKeyField()&&(a=!0)}}catch(c){u.e(c)}finally{u.f()}if(!a){var s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.V.push(new tt(oe.keyField(),s))}}}return t.V}function vt(e){var t=O(e);if(!t.S)if("F"===t.limitType)t.S=qe(t.path,t.collectionGroup,dt(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=b(dt(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,u="desc"===a.dir?"asc":"desc";r.push(new tt(a.field,u))}}catch(c){i.e(c)}finally{i.f()}var o=t.endAt?new $e(t.endAt.position,!t.endAt.before):null,s=t.startAt?new $e(t.startAt.position,!t.startAt.before):null;t.S=qe(t.path,t.collectionGroup,r,t.filters,t.limit,o,s)}return t.S}function yt(e,t,n){return new at(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function pt(e,t){return Be(vt(e),vt(t))&&e.limitType===t.limitType}function mt(e){return"".concat(Ue(vt(e)),"|lt:").concat(e.limitType)}function gt(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(Ne(t.value));var t})).join(", "),"]")),ge(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: "+et(e.startAt)),e.endAt&&(t+=", endAt: "+et(e.endAt)),"Target(".concat(t,")")}(vt(e)),"; limitType=").concat(e.limitType,")")}function kt(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):be.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=b(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=b(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!rt(e.startAt,dt(e),t))&&(!e.endAt||!rt(e.endAt,dt(e),t))}(e,t)}function wt(e){return function(t,n){var r,i=!1,a=b(dt(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,o=bt(u,t,n);if(0!==o)return o;i=i||u.field.isKeyField()}}catch(s){a.e(s)}finally{a.f()}return 0}}function bt(e,t,n){var r=e.field.isKeyField()?be.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ee(r,i):R()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return R()}}function xt(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ke(t)?"-0":t}}function It(e){return{integerValue:""+e}}function Tt(e,t){return we(t)?It(t):xt(e,t)}var Et=function e(){(0,h.Z)(this,e),this._=void 0};function St(e,t,n){return e instanceof At?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Dt?Zt(e,t):e instanceof Ct?Lt(e,t):function(e,t){var n=_t(e,t),r=Ft(n)+Ft(e.C);return De(n)&&De(e.C)?It(r):xt(e.N,r)}(e,t)}function Nt(e,t,n){return e instanceof Dt?Zt(e,t):e instanceof Ct?Lt(e,t):n}function _t(e,t){return e instanceof Rt?De(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var At=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return n}(Et),Dt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).elements=e,r}return n}(Et);function Zt(e,t){var n,r=Mt(t),i=b(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return Ie(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Ct=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).elements=e,r}return n}(Et);function Lt(e,t){var n,r=Mt(t),i=b(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!Ie(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Rt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).N=e,i.C=r,i}return n}(Et);function Ft(e){return de(e.integerValue||e.doubleValue)}function Mt(e){return Ze(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Ot=function e(t,n){(0,h.Z)(this,e),this.field=t,this.transform=n};var Vt=function e(t,n){(0,h.Z)(this,e),this.version=t,this.transformResults=n},Pt=function(){function e(t,n){(0,h.Z)(this,e),this.updateTime=t,this.exists=n}return(0,d.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function qt(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Ut=function e(){(0,h.Z)(this,e)};function Bt(e,t,n){e instanceof Qt?function(e,t,n){var r=e.value.clone(),i=Yt(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ht?function(e,t,n){if(qt(e.precondition,t)){var r=Yt(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Wt(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Kt(e,t,n){e instanceof Qt?function(e,t,n){if(qt(e.precondition,t)){var r=e.value.clone(),i=Jt(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(jt(t),r).setHasLocalMutations()}}(e,t,n):e instanceof Ht?function(e,t,n){if(qt(e.precondition,t)){var r=Jt(e.fieldTransforms,n,t),i=t.data;i.setAll(Wt(e)),i.setAll(r),t.convertToFoundDocument(jt(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){qt(e.precondition,t)&&t.convertToNoDocument(ee.min())}(e,t)}function zt(e,t){var n,r=null,i=b(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),o=_t(a.transform,u||null);null!=o&&(null==r&&(r=Me.empty()),r.set(a.field,o))}}catch(s){i.e(s)}finally{i.f()}return r||null}function Gt(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&J(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Dt&&t instanceof Dt||e instanceof Ct&&t instanceof Ct?J(e.elements,t.elements,Ie):e instanceof Rt&&t instanceof Rt?Ie(e.C,t.C):e instanceof At&&t instanceof At}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function jt(e){return e.isFoundDocument()?e.version:ee.min()}var Qt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,h.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return n}(Ut),Ht=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,h.Z)(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return n}(Ut);function Wt(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function Yt(e,t,n){var r=new Map;F(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,Nt(u,o,n[i]))}return r}function Jt(e,t,n){var r,i=new Map,a=b(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,o=u.transform,s=n.data.field(u.field);i.set(u.field,St(o,s,t))}}catch(c){a.e(c)}finally{a.f()}return i}var Xt,$t,en=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return n}(Ut),tn=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return n}(Ut),nn=function e(t){(0,h.Z)(this,e),this.count=t};function rn(e){switch(e){default:return R();case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0}}function an(e){if(void 0===e)return Z("GRPC error has no .code"),V.UNKNOWN;switch(e){case Xt.OK:return V.OK;case Xt.CANCELLED:return V.CANCELLED;case Xt.UNKNOWN:return V.UNKNOWN;case Xt.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Xt.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Xt.INTERNAL:return V.INTERNAL;case Xt.UNAVAILABLE:return V.UNAVAILABLE;case Xt.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Xt.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Xt.NOT_FOUND:return V.NOT_FOUND;case Xt.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Xt.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Xt.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Xt.ABORTED:return V.ABORTED;case Xt.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Xt.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Xt.DATA_LOSS:return V.DATA_LOSS;default:return R()}}($t=Xt||(Xt={}))[$t.OK=0]="OK",$t[$t.CANCELLED=1]="CANCELLED",$t[$t.UNKNOWN=2]="UNKNOWN",$t[$t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$t[$t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$t[$t.NOT_FOUND=5]="NOT_FOUND",$t[$t.ALREADY_EXISTS=6]="ALREADY_EXISTS",$t[$t.PERMISSION_DENIED=7]="PERMISSION_DENIED",$t[$t.UNAUTHENTICATED=16]="UNAUTHENTICATED",$t[$t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$t[$t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$t[$t.ABORTED=10]="ABORTED",$t[$t.OUT_OF_RANGE=11]="OUT_OF_RANGE",$t[$t.UNIMPLEMENTED=12]="UNIMPLEMENTED",$t[$t.INTERNAL=13]="INTERNAL",$t[$t.UNAVAILABLE=14]="UNAVAILABLE",$t[$t.DATA_LOSS=15]="DATA_LOSS";var un=function(){function e(t,n){(0,h.Z)(this,e),this.comparator=t,this.root=n||sn.EMPTY}return(0,d.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,sn.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,sn.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new on(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new on(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new on(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new on(this.root,e,this.comparator,!0)}}]),e}(),on=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,d.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),sn=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,d.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw R();if(this.right.isRed())throw R();var e=this.left.check();if(e!==this.right.check())throw R();return e+(this.isRed()?0:1)}}]),e}();sn.EMPTY=null,sn.RED=!0,sn.BLACK=!1,sn.EMPTY=new(function(){function e(){(0,h.Z)(this,e),this.size=0}return(0,d.Z)(e,[{key:"key",get:function(){throw R()}},{key:"value",get:function(){throw R()}},{key:"color",get:function(){throw R()}},{key:"left",get:function(){throw R()}},{key:"right",get:function(){throw R()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new sn(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var cn=function(){function e(t){(0,h.Z)(this,e),this.comparator=t,this.data=new un(this.comparator)}return(0,d.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new ln(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new ln(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),ln=function(){function e(t){(0,h.Z)(this,e),this.iter=t}return(0,d.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}(),fn=new un(be.comparator);function hn(){return fn}var dn=new un(be.comparator);function vn(){return dn}var yn=new un(be.comparator);function pn(){return yn}var mn=new cn(be.comparator);function gn(){for(var e=mn,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var kn=new cn(Y);function wn(){return kn}var bn=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,d.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,xn.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(ee.min(),r,wn(),hn(),gn())}}]),e}(),xn=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,d.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(le.EMPTY_BYTE_STRING,n,gn(),gn(),gn())}}]),e}(),In=function e(t,n,r,i){(0,h.Z)(this,e),this.k=t,this.removedTargetIds=n,this.key=r,this.$=i},Tn=function e(t,n){(0,h.Z)(this,e),this.targetId=t,this.O=n},En=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:le.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,h.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i},Sn=function(){function e(){(0,h.Z)(this,e),this.F=0,this.M=An(),this.L=le.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}return(0,d.Z)(e,[{key:"current",get:function(){return this.B}},{key:"resumeToken",get:function(){return this.L}},{key:"q",get:function(){return 0!==this.F}},{key:"K",get:function(){return this.U}},{key:"j",value:function(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}},{key:"W",value:function(){var e=gn(),t=gn(),n=gn();return this.M.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:R()}})),new xn(this.L,this.B,e,t,n)}},{key:"G",value:function(){this.U=!1,this.M=An()}},{key:"H",value:function(e,t){this.U=!0,this.M=this.M.insert(e,t)}},{key:"J",value:function(e){this.U=!0,this.M=this.M.remove(e)}},{key:"Y",value:function(){this.F+=1}},{key:"X",value:function(){this.F-=1}},{key:"Z",value:function(){this.U=!0,this.B=!0}}]),e}(),Nn=function(){function e(t){(0,h.Z)(this,e),this.tt=t,this.et=new Map,this.nt=hn(),this.st=_n(),this.it=new cn(Y)}return(0,d.Z)(e,[{key:"rt",value:function(e){var t,n=b(e.k);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.$&&e.$.isFoundDocument()?this.ot(r,e.$):this.at(r,e.key,e.$)}}catch(o){n.e(o)}finally{n.f()}var i,a=b(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.at(u,e.key,e.$)}}catch(o){a.e(o)}finally{a.f()}}},{key:"ct",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.ut(n);switch(e.state){case 0:t.ht(n)&&r.j(e.resumeToken);break;case 1:r.X(),r.q||r.G(),r.j(e.resumeToken);break;case 2:r.X(),r.q||t.removeTarget(n);break;case 3:t.ht(n)&&(r.Z(),r.j(e.resumeToken));break;case 4:t.ht(n)&&(t.lt(n),r.j(e.resumeToken));break;default:R()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.et.forEach((function(e,r){n.ht(r)&&t(r)}))}},{key:"ft",value:function(e){var t=e.targetId,n=e.O.count,r=this.dt(t);if(r){var i=r.target;if(Ke(i))if(0===n){var a=new be(i.path);this.at(t,a,Ve.newNoDocument(a,ee.min()))}else F(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}},{key:"_t",value:function(e){var t=this,n=new Map;this.et.forEach((function(r,i){var a=t.dt(i);if(a){if(r.current&&Ke(a.target)){var u=new be(a.target.path);null!==t.nt.get(u)||t.gt(i,u)||t.at(i,u,Ve.newNoDocument(u,e))}r.K&&(n.set(i,r.W()),r.G())}}));var r=gn();this.st.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.dt(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))}));var i=new bn(e,n,this.it,this.nt,r);return this.nt=hn(),this.st=_n(),this.it=new cn(Y),i}},{key:"ot",value:function(e,t){if(this.ht(e)){var n=this.gt(e,t.key)?2:0;this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e))}}},{key:"at",value:function(e,t,n){if(this.ht(e)){var r=this.ut(e);this.gt(e,t)?r.H(t,1):r.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}}},{key:"removeTarget",value:function(e){this.et.delete(e)}},{key:"wt",value:function(e){var t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Y",value:function(e){this.ut(e).Y()}},{key:"ut",value:function(e){var t=this.et.get(e);return t||(t=new Sn,this.et.set(e,t)),t}},{key:"yt",value:function(e){var t=this.st.get(e);return t||(t=new cn(Y),this.st=this.st.insert(e,t)),t}},{key:"ht",value:function(e){var t=null!==this.dt(e);return t||D("WatchChangeAggregator","Detected inactive target",e),t}},{key:"dt",value:function(e){var t=this.et.get(e);return t&&t.q?null:this.tt.Tt(e)}},{key:"lt",value:function(e){var t=this;this.et.set(e,new Sn),this.tt.getRemoteKeysForTarget(e).forEach((function(n){t.at(e,n,null)}))}},{key:"gt",value:function(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}]),e}();function _n(){return new un(be.comparator)}function An(){return new un(be.comparator)}var Dn={asc:"ASCENDING",desc:"DESCENDING"},Zn={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cn=function e(t,n){(0,h.Z)(this,e),this.databaseId=t,this.D=n};function Ln(e,t){return e.D?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Rn(e,t){return e.D?t.toBase64():t.toUint8Array()}function Fn(e,t){return Ln(e,t.toTimestamp())}function Mn(e){return F(!!e),ee.fromTimestamp(function(e){var t=he(e);return new $(t.seconds,t.nanos)}(e))}function On(e,t){return function(e){return new ae(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Vn(e){var t=ae.fromString(e);return F(cr(t)),t}function Pn(e,t){return On(e.databaseId,t.path)}function qn(e,t){var n=Vn(t);if(n.get(1)!==e.databaseId.projectId)throw new P(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new P(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new be(zn(n))}function Un(e,t){return On(e.databaseId,t)}function Bn(e){var t=Vn(e);return 4===t.length?ae.emptyPath():zn(t)}function Kn(e){return new ae(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function zn(e){return F(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Gn(e,t,n){return{name:Pn(e,t),fields:n.value.mapValue.fields}}function jn(e,t,n){var r=qn(e,t.name),i=Mn(t.updateTime),a=new Me({mapValue:{fields:t.fields}}),u=Ve.newFoundDocument(r,i,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function Qn(e,t){return"found"in t?function(e,t){F(!!t.found),t.found.name,t.found.updateTime;var n=qn(e,t.found.name),r=Mn(t.found.updateTime),i=new Me({mapValue:{fields:t.found.fields}});return Ve.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){F(!!t.missing),F(!!t.readTime);var n=qn(e,t.missing),r=Mn(t.readTime);return Ve.newNoDocument(n,r)}(e,t):R()}function Hn(e,t){var n;if(t instanceof Qt)n={update:Gn(e,t.key,t.value)};else if(t instanceof en)n={delete:Pn(e,t.key)};else if(t instanceof Ht)n={update:Gn(e,t.key,t.data),updateMask:sr(t.fieldMask)};else{if(!(t instanceof tn))return R();n={verify:Pn(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof At)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Dt)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ct)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Rt)return{fieldPath:t.field.canonicalString(),increment:n.C};throw R()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Fn(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:R()}(e,t.precondition)),n}function Wn(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Pt.updateTime(Mn(e.updateTime)):void 0!==e.exists?Pt.exists(e.exists):Pt.none()}(t.currentDocument):Pt.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)F("REQUEST_TIME"===t.setToServerValue),n=new At;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Dt(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Ct(i)}else"increment"in t?n=new Rt(e,t.increment):R();var a=oe.fromServerFormat(t.fieldPath);return new Ot(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=qn(e,t.update.name),a=new Me({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new se(t.map((function(e){return oe.fromServerFormat(e)})))}(t.updateMask);return new Ht(i,a,u,n,r)}return new Qt(i,a,n,r)}if(t.delete){var o=qn(e,t.delete);return new en(o,n)}if(t.verify){var s=qn(e,t.verify);return new tn(s,n)}return R()}function Yn(e,t){return{documents:[Un(e,t.path)]}}function Jn(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Un(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Un(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(Le(e.value))return{unaryFilter:{field:ir(e.field),op:"IS_NAN"}};if(Ce(e.value))return{unaryFilter:{field:ir(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Le(e.value))return{unaryFilter:{field:ir(e.field),op:"IS_NOT_NAN"}};if(Ce(e.value))return{unaryFilter:{field:ir(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ir(e.field),op:rr(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:ir(e.field),direction:nr(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var u=function(e,t){return e.D||ge(t)?t:{value:t}}(e,t.limit);return null!==u&&(n.structuredQuery.limit=u),t.startAt&&(n.structuredQuery.startAt=er(t.startAt)),t.endAt&&(n.structuredQuery.endAt=er(t.endAt)),n}function Xn(e){var t=Bn(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){F(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=$n(n.where));var o=[];n.orderBy&&(o=n.orderBy.map((function(e){return function(e){return new tt(ar(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var s=null;n.limit&&(s=function(e){var t;return ge(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=tr(n.startAt));var l=null;return n.endAt&&(l=tr(n.endAt)),ut(t,i,o,u,s,"F",c,l)}function $n(e){return e?void 0!==e.unaryFilter?[or(e)]:void 0!==e.fieldFilter?[ur(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return $n(e)})).reduce((function(e,t){return e.concat(t)})):R():[]}function er(e){return{before:e.before,values:e.position}}function tr(e){var t=!!e.before,n=e.values||[];return new $e(n,t)}function nr(e){return Dn[e]}function rr(e){return Zn[e]}function ir(e){return{fieldPath:e.canonicalString()}}function ar(e){return oe.fromServerFormat(e.fieldPath)}function ur(e){return ze.create(ar(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return R()}}(e.fieldFilter.op),e.fieldFilter.value)}function or(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ar(e.unaryFilter.field);return ze.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ar(e.unaryFilter.field);return ze.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ar(e.unaryFilter.field);return ze.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ar(e.unaryFilter.field);return ze.create(i,"!=",{nullValue:"NULL_VALUE"});default:return R()}}function sr(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function cr(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function lr(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=hr(t)),t=fr(e.get(n),t);return hr(t)}function fr(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="";break;case"":n+="";break;default:n+=a}}return n}function hr(e){return e+""}function dr(e){var t=e.length;if(F(t>=2),2===t)return F(""===e.charAt(0)&&""===e.charAt(1)),ae.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var u=e.indexOf("",a);switch((u<0||u>n)&&R(),e.charAt(u+1)){case"":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=""),r.push(s);break;case"":i+=e.substring(a,u),i+="\0";break;case"":i+=e.substring(a,u+1);break;default:R()}a=u+2}return new ae(r)}var vr=function e(t,n){(0,h.Z)(this,e),this.seconds=t,this.nanoseconds=n},yr=function e(t,n,r){(0,h.Z)(this,e),this.ownerId=t,this.allowTabSynchronization=n,this.leaseTimestampMs=r};yr.store="owner",yr.key="owner";var pr=function e(t,n,r){(0,h.Z)(this,e),this.userId=t,this.lastAcknowledgedBatchId=n,this.lastStreamToken=r};pr.store="mutationQueues",pr.keyPath="userId";var mr=function e(t,n,r,i,a){(0,h.Z)(this,e),this.userId=t,this.batchId=n,this.localWriteTimeMs=r,this.baseMutations=i,this.mutations=a};mr.store="mutations",mr.keyPath="batchId",mr.userMutationsIndex="userMutationsIndex",mr.userMutationsKeyPath=["userId","batchId"];var gr=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,null,[{key:"prefixForUser",value:function(e){return[e]}},{key:"prefixForPath",value:function(e,t){return[e,lr(t)]}},{key:"key",value:function(e,t,n){return[e,lr(t),n]}}]),e}();gr.store="documentMutations",gr.PLACEHOLDER=new gr;var kr=function e(t,n){(0,h.Z)(this,e),this.path=t,this.readTime=n},wr=function e(t,n){(0,h.Z)(this,e),this.path=t,this.version=n},br=function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.unknownDocument=t,this.noDocument=n,this.document=r,this.hasCommittedMutations=i,this.readTime=a,this.parentPath=u};br.store="remoteDocuments",br.readTimeIndex="readTimeIndex",br.readTimeIndexPath="readTime",br.collectionReadTimeIndex="collectionReadTimeIndex",br.collectionReadTimeIndexPath=["parentPath","readTime"];var xr=function e(t){(0,h.Z)(this,e),this.byteSize=t};xr.store="remoteDocumentGlobal",xr.key="remoteDocumentGlobalKey";var Ir=function e(t,n,r,i,a,u,o){(0,h.Z)(this,e),this.targetId=t,this.canonicalId=n,this.readTime=r,this.resumeToken=i,this.lastListenSequenceNumber=a,this.lastLimboFreeSnapshotVersion=u,this.query=o};Ir.store="targets",Ir.keyPath="targetId",Ir.queryTargetsIndexName="queryTargetsIndex",Ir.queryTargetsKeyPath=["canonicalId","targetId"];var Tr=function e(t,n,r){(0,h.Z)(this,e),this.targetId=t,this.path=n,this.sequenceNumber=r};Tr.store="targetDocuments",Tr.keyPath=["targetId","path"],Tr.documentTargetsIndex="documentTargetsIndex",Tr.documentTargetsKeyPath=["path","targetId"];var Er=function e(t,n,r,i){(0,h.Z)(this,e),this.highestTargetId=t,this.highestListenSequenceNumber=n,this.lastRemoteSnapshotVersion=r,this.targetCount=i};Er.key="targetGlobalKey",Er.store="targetGlobal";var Sr=function e(t,n){(0,h.Z)(this,e),this.collectionId=t,this.parent=n};Sr.store="collectionParents",Sr.keyPath=["collectionId","parent"];var Nr=function e(t,n,r,i){(0,h.Z)(this,e),this.clientId=t,this.updateTimeMs=n,this.networkEnabled=r,this.inForeground=i};Nr.store="clientMetadata",Nr.keyPath="clientId";var _r=function e(t,n,r){(0,h.Z)(this,e),this.bundleId=t,this.createTime=n,this.version=r};_r.store="bundles",_r.keyPath="bundleId";var Ar=function e(t,n,r){(0,h.Z)(this,e),this.name=t,this.readTime=n,this.bundledQuery=r};Ar.store="namedQueries",Ar.keyPath="name";var Dr=[pr.store,mr.store,gr.store,br.store,Ir.store,yr.store,Er.store,Tr.store].concat([Nr.store]).concat([xr.store]).concat([Sr.store]).concat([_r.store,Ar.store]),Zr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Cr=function(){function e(){(0,h.Z)(this,e),this.onCommittedListeners=[]}return(0,d.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}(),Lr=function(){function e(t){var n=this;(0,h.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,d.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&R(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=b(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}}]),e}(),Rr=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.Et=new q,this.transaction.oncomplete=function(){r.Et.resolve()},this.transaction.onabort=function(){n.error?r.Et.reject(new Or(t,n.error)):r.Et.resolve()},this.transaction.onerror=function(e){var n=Br(e.target.error);r.Et.reject(new Or(t,n))}}return(0,d.Z)(e,[{key:"It",get:function(){return this.Et.promise}},{key:"abort",value:function(e){e&&this.Et.reject(e),this.aborted||(D("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Pr(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Or(n,t)}}}]),e}(),Fr=function(){function e(t,n,r){(0,h.Z)(this,e),this.name=t,this.version=n,this.At=r,12.2===e.Rt((0,k.z$)())&&Z("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var t,n;return(0,d.Z)(e,[{key:"Dt",value:(n=(0,u.Z)(y().mark((function e(t){var n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return D("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Or(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new P(V.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new P(V.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Or(t,n))},i.onupgradeneeded=function(e){D("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.At.Ct(t,i.transaction,e.oldVersion,n.version).next((function(){D("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.Nt&&(this.db.onversionchange=function(e){return n.Nt(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"xt",value:function(e){this.Nt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:(t=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o,s,c=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,u=0;case 2:return++u,e.prev=3,e.delegateYield(y().mark((function e(){var n,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Dt(t);case 2:return c.db=e.sent,n=Rr.open(c.db,t,a?"readonly":"readwrite",r),u=i(n).catch((function(e){return n.abort(e),Lr.reject(e)})).toPromise(),u.catch((function(){})),e.next=7,n.It;case 7:return e.t0=u,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!=typeof(o=e.t0)){e.next=8;break}return e.abrupt("return",o.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),s="FirebaseError"!==e.t1.name&&u<3,D("SimpleDb","Transaction failed with error:",e.t1.message,"Retrying:",s),this.close(),s){e.next=15;break}return e.abrupt("return",Promise.reject(e.t1));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(e,n,r,i){return t.apply(this,arguments)})},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return D("SimpleDb","Removing database:",e),qr(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"bt",value:function(){if(!(0,k.hl)())return!1;if(e.Pt())return!0;var t=(0,k.z$)(),n=e.Rt(t),r=0<n&&n<10,i=e.vt(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"Pt",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={})||void 0===e?void 0:e.Vt)}},{key:"St",value:function(e,t){return e.store(t)}},{key:"Rt",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"vt",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Mr=function(){function e(t){(0,h.Z)(this,e),this.kt=t,this.$t=!1,this.Ot=null}return(0,d.Z)(e,[{key:"isDone",get:function(){return this.$t}},{key:"Ft",get:function(){return this.Ot}},{key:"cursor",set:function(e){this.kt=e}},{key:"done",value:function(){this.$t=!0}},{key:"Mt",value:function(e){this.Ot=e}},{key:"delete",value:function(){return qr(this.kt.delete())}}]),e}(),Or=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,V.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return n}(P);function Vr(e){return"IndexedDbTransactionError"===e.name}var Pr=function(){function e(t){(0,h.Z)(this,e),this.store=t}return(0,d.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(D("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(D("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),qr(n)}},{key:"add",value:function(e){return D("SimpleDb","ADD",this.store.name,e,e),qr(this.store.add(e))}},{key:"get",value:function(e){var t=this;return qr(this.store.get(e)).next((function(n){return void 0===n&&(n=null),D("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return D("SimpleDb","DELETE",this.store.name,e),qr(this.store.delete(e))}},{key:"count",value:function(){return D("SimpleDb","COUNT",this.store.name),qr(this.store.count())}},{key:"Lt",value:function(e,t){var n=this.cursor(this.options(e,t)),r=[];return this.Bt(n,(function(e,t){r.push(t)})).next((function(){return r}))}},{key:"Ut",value:function(e,t){D("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.qt=!1;var r=this.cursor(n);return this.Bt(r,(function(e,t,n){return n.delete()}))}},{key:"Kt",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Bt(r,t)}},{key:"jt",value:function(e){var t=this.cursor({});return new Lr((function(n,r){t.onerror=function(e){var t=Br(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"Bt",value:function(e,t){var n=[];return new Lr((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Mr(i),u=t(i.primaryKey,i.value,a);if(u instanceof Lr){var o=u.catch((function(e){return a.done(),Lr.reject(e)}));n.push(o)}a.isDone?r():null===a.Ft?i.continue():i.continue(a.Ft)}else r()}})).next((function(){return Lr.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function qr(e){return new Lr((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Br(e.target.error);n(t)}}))}var Ur=!1;function Br(e){var t=Fr.Rt((0,k.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new P("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Ur||(Ur=!0,setTimeout((function(){throw r}),0)),r}}return e}var Kr=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).Qt=e,i.currentSequenceNumber=r,i}return n}(Cr);function zr(e,t){var n=O(e);return Fr.St(n.Qt,t)}var Gr=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,d.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&Bt(i,e,n[r])}}},{key:"applyToLocalView",value:function(e){var t,n=b(this.baseMutations);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.key.isEqual(e.key)&&Kt(r,e,this.localWriteTime)}}catch(o){n.e(o)}finally{n.f()}var i,a=b(this.mutations);try{for(a.s();!(i=a.n()).done;){var u=i.value;u.key.isEqual(e.key)&&Kt(u,e,this.localWriteTime)}}catch(o){a.e(o)}finally{a.f()}}},{key:"applyToLocalDocumentSet",value:function(e){var t=this;this.mutations.forEach((function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(ee.min())}))}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),gn())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&J(this.mutations,e.mutations,(function(e,t){return Gt(e,t)}))&&J(this.baseMutations,e.baseMutations,(function(e,t){return Gt(e,t)}))}}]),e}(),jr=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,d.Z)(e,null,[{key:"from",value:function(t,n,r){F(t.mutations.length===r.length);for(var i=pn(),a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),Qr=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ee.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ee.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:le.EMPTY_BYTE_STRING;(0,h.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o}return(0,d.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Hr=function e(t){(0,h.Z)(this,e),this.Wt=t};function Wr(e,t){if(t.document)return jn(e.Wt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=be.fromSegments(t.noDocument.path),r=ei(t.noDocument.readTime),i=Ve.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var a=be.fromSegments(t.unknownDocument.path),u=ei(t.unknownDocument.version);return Ve.newUnknownDocument(a,u)}return R()}function Yr(e,t,n){var r=Jr(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var a=function(e,t){return{name:Pn(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Ln(e,t.version.toTimestamp())}}(e.Wt,t),u=t.hasCommittedMutations;return new br(null,null,a,u,r,i)}if(t.isNoDocument()){var o=t.key.path.toArray(),s=$r(t.version),c=t.hasCommittedMutations;return new br(null,new kr(o,s),null,c,r,i)}if(t.isUnknownDocument()){var l=t.key.path.toArray(),f=$r(t.version);return new br(new wr(l,f),null,null,!0,r,i)}return R()}function Jr(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Xr(e){var t=new $(e[0],e[1]);return ee.fromTimestamp(t)}function $r(e){var t=e.toTimestamp();return new vr(t.seconds,t.nanoseconds)}function ei(e){var t=new $(e.seconds,e.nanoseconds);return ee.fromTimestamp(t)}function ti(e,t){for(var n=(t.baseMutations||[]).map((function(t){return Wn(e.Wt,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map((function(t){return Wn(e.Wt,t)})),o=$.fromMillis(t.localWriteTimeMs);return new Gr(t.batchId,o,n,u)}function ni(e){var t,n,r=ei(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?ei(e.lastLimboFreeSnapshotVersion):ee.min();return void 0!==e.query.documents?(F(1===(n=e.query).documents.length),t=vt(ot(Bn(n.documents[0])))):t=function(e){return vt(Xn(e))}(e.query),new Qr(t,e.targetId,0,e.lastListenSequenceNumber,r,i,le.fromBase64String(e.resumeToken))}function ri(e,t){var n,r=$r(t.snapshotVersion),i=$r(t.lastLimboFreeSnapshotVersion);n=Ke(t.target)?Yn(e.Wt,t.target):Jn(e.Wt,t.target);var a=t.resumeToken.toBase64();return new Ir(t.targetId,Ue(t.target),r,a,t.sequenceNumber,i,n)}function ii(e){var t=Xn({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?yt(t,t.limit,"L"):t}var ai=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return ui(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:ei(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return ui(e).put({bundleId:(n=t).id,createTime:$r(Mn(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return oi(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:ii(t.bundledQuery),readTime:ei(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return oi(e).put(function(e){return{name:e.name,readTime:$r(Mn(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function ui(e){return zr(e,_r.store)}function oi(e){return zr(e,Ar.store)}var si=function(){function e(){(0,h.Z)(this,e),this.Gt=new ci}return(0,d.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.Gt.add(t),Lr.resolve()}},{key:"getCollectionParents",value:function(e,t){return Lr.resolve(this.Gt.getEntries(t))}}]),e}(),ci=function(){function e(){(0,h.Z)(this,e),this.index={}}return(0,d.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new cn(ae.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new cn(ae.comparator)).toArray()}}]),e}(),li=function(){function e(){(0,h.Z)(this,e),this.zt=new ci}return(0,d.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.zt.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.zt.add(t)}));var a={collectionId:r,parent:lr(i)};return fi(e).put(a)}return Lr.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[X(t),""],!1,!0);return fi(e).Lt(r).next((function(e){var r,i=b(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(dr(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n}))}}]),e}();function fi(e){return zr(e,Sr.store)}var hi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},di=function(){function e(t,n,r){(0,h.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,d.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function vi(e,t,n){var r=e.store(mr.store),i=e.store(gr.store),a=[],u=IDBKeyRange.only(n.batchId),o=0,s=r.Kt({range:u},(function(e,t,n){return o++,n.delete()}));a.push(s.next((function(){F(1===o)})));var c,l=[],f=b(n.mutations);try{for(f.s();!(c=f.n()).done;){var h=c.value,d=gr.key(t,h.key.path,n.batchId);a.push(i.delete(d)),l.push(h.key)}}catch(v){f.e(v)}finally{f.f()}return Lr.waitFor(a).next((function(){return l}))}function yi(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw R();t=e.noDocument}return JSON.stringify(t).length}di.DEFAULT_COLLECTION_PERCENTILE=10,di.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,di.DEFAULT=new di(41943040,di.DEFAULT_COLLECTION_PERCENTILE,di.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),di.DISABLED=new di(-1,0,0);var pi=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.userId=t,this.N=n,this.Ht=r,this.referenceDelegate=i,this.Jt={}}return(0,d.Z)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gi(e).Kt({index:mr.userMutationsIndex,range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=ki(e),u=gi(e);return u.add({}).next((function(o){F("number"==typeof o);var s,c=new Gr(o,t,n,r),l=function(e,t,n){var r=n.baseMutations.map((function(t){return Hn(e.Wt,t)})),i=n.mutations.map((function(t){return Hn(e.Wt,t)}));return new mr(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.N,i.userId,c),f=[],h=new cn((function(e,t){return Y(e.canonicalString(),t.canonicalString())})),d=b(r);try{for(d.s();!(s=d.n()).done;){var v=s.value,y=gr.key(i.userId,v.key.path,o);h=h.add(v.key.path.popLast()),f.push(u.put(l)),f.push(a.put(y,gr.PLACEHOLDER))}}catch(p){d.e(p)}finally{d.f()}return h.forEach((function(t){f.push(i.Ht.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.Jt[o]=c.keys()})),Lr.waitFor(f).next((function(){return c}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return gi(e).get(t).next((function(e){return e?(F(e.userId===n.userId),ti(n.N,e)):null}))}},{key:"Xt",value:function(e,t){var n=this;return this.Jt[t]?Lr.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.Jt[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return gi(e).Kt({index:mr.userMutationsIndex,range:i},(function(e,t,i){t.userId===n.userId&&(F(t.batchId>=r),a=ti(n.N,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return gi(e).Kt({index:mr.userMutationsIndex,range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return gi(e).Lt(mr.userMutationsIndex,n).next((function(e){return e.map((function(e){return ti(t.N,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=gr.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(r),u=[];return ki(e).Kt({range:i},(function(r,i,o){var s=(0,a.Z)(r,3),c=s[0],l=s[1],f=s[2],h=dr(l);if(c===n.userId&&t.path.isEqual(h))return gi(e).get(f).next((function(e){if(!e)throw R();F(e.userId===n.userId),u.push(ti(n.N,e))}));o.done()})).next((function(){return u}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new cn(Y),i=[];return t.forEach((function(t){var u=gr.prefixForPath(n.userId,t.path),o=IDBKeyRange.lowerBound(u),s=ki(e).Kt({range:o},(function(e,i,u){var o=(0,a.Z)(e,3),s=o[0],c=o[1],l=o[2],f=dr(c);s===n.userId&&t.path.isEqual(f)?r=r.add(l):u.done()}));i.push(s)})),Lr.waitFor(i).next((function(){return n.Zt(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,u=gr.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(u),s=new cn(Y);return ki(e).Kt({range:o},(function(e,t,u){var o=(0,a.Z)(e,3),c=o[0],l=o[1],f=o[2],h=dr(l);c===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(f)):u.done()})).next((function(){return n.Zt(e,s)}))}},{key:"Zt",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(gi(e).get(t).next((function(e){if(null===e)throw R();F(e.userId===n.userId),r.push(ti(n.N,e))})))})),Lr.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return vi(e.Qt,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.te(t.batchId)})),Lr.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"te",value:function(e){delete this.Jt[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return Lr.resolve();var r=IDBKeyRange.lowerBound(gr.prefixForUser(t.userId)),i=[];return ki(e).Kt({range:r},(function(e,n,r){if(e[0]===t.userId){var a=dr(e[1]);i.push(a)}else r.done()})).next((function(){F(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return mi(e,this.userId,t)}},{key:"ee",value:function(e){var t=this;return wi(e).get(this.userId).next((function(e){return e||new pr(t.userId,-1,"")}))}}],[{key:"Yt",value:function(t,n,r,i){return F(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function mi(e,t,n){var r=gr.prefixForPath(t,n.path),i=r[1],u=IDBKeyRange.lowerBound(r),o=!1;return ki(e).Kt({range:u,qt:!0},(function(e,n,r){var u=(0,a.Z)(e,3),s=u[0],c=u[1];u[2];s===t&&c===i&&(o=!0),r.done()})).next((function(){return o}))}function gi(e){return zr(e,mr.store)}function ki(e){return zr(e,gr.store)}function wi(e){return zr(e,pr.store)}var bi=function(){function e(t){(0,h.Z)(this,e),this.ne=t}return(0,d.Z)(e,[{key:"next",value:function(){return this.ne+=2,this.ne}}],[{key:"se",value:function(){return new e(0)}},{key:"ie",value:function(){return new e(-1)}}]),e}(),xi=function(){function e(t,n){(0,h.Z)(this,e),this.referenceDelegate=t,this.N=n}return(0,d.Z)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.re(e).next((function(n){var r=new bi(n.highestTargetId);return n.highestTargetId=r.next(),t.oe(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.re(e).next((function(e){return ee.fromTimestamp(new $(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.re(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.re(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.oe(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.ae(e,t).next((function(){return n.re(e).next((function(r){return r.targetCount+=1,n.ce(t,r),n.oe(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.ae(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Ii(e).delete(t.targetId)})).next((function(){return n.re(e)})).next((function(t){return F(t.targetCount>0),t.targetCount-=1,n.oe(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Ii(e).Kt((function(u,o){var s=ni(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))})).next((function(){return Lr.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return Ii(e).Kt((function(e,n){var r=ni(n);t(r)}))}},{key:"re",value:function(e){return Ti(e).get(Er.key).next((function(e){return F(null!==e),e}))}},{key:"oe",value:function(e,t){return Ti(e).put(Er.key,t)}},{key:"ae",value:function(e,t){return Ii(e).put(ri(this.N,t))}},{key:"ce",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.re(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=Ue(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ii(e).Kt({range:r,index:Ir.queryTargetsIndexName},(function(e,n,r){var a=ni(n);Be(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=Ei(e);return t.forEach((function(t){var u=lr(t.path);i.push(a.put(new Tr(n,u))),i.push(r.referenceDelegate.addReference(e,n,t))})),Lr.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=Ei(e);return Lr.forEach(t,(function(t){var a=lr(t.path);return Lr.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Ei(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ei(e),i=gn();return r.Kt({range:n,qt:!0},(function(e,t,n){var r=dr(e[1]),a=new be(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=lr(t.path),r=IDBKeyRange.bound([n],[X(n)],!1,!0),i=0;return Ei(e).Kt({index:Tr.documentTargetsIndex,qt:!0,range:r},(function(e,t,n){var r=(0,a.Z)(e,2),u=r[0];r[1];0!==u&&(i++,n.done())})).next((function(){return i>0}))}},{key:"Tt",value:function(e,t){return Ii(e).get(t).next((function(e){return e?ni(e):null}))}}]),e}();function Ii(e){return zr(e,Ir.store)}function Ti(e){return zr(e,Er.store)}function Ei(e){return zr(e,Tr.store)}function Si(e){return Ni.apply(this,arguments)}function Ni(){return(Ni=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===V.FAILED_PRECONDITION&&t.message===Zr){e.next=2;break}throw t;case 2:D("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _i(e,t){var n=(0,a.Z)(e,2),r=n[0],i=n[1],u=(0,a.Z)(t,2),o=u[0],s=u[1],c=Y(r,o);return 0===c?Y(i,s):c}var Ai=function(){function e(t){(0,h.Z)(this,e),this.ue=t,this.buffer=new cn(_i),this.he=0}return(0,d.Z)(e,[{key:"le",value:function(){return++this.he}},{key:"fe",value:function(e){var t=[e,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();_i(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Di=function(){function e(t,n){(0,h.Z)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.de=!1,this.we=null}return(0,d.Z)(e,[{key:"start",value:function(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}},{key:"stop",value:function(){this.we&&(this.we.cancel(),this.we=null)}},{key:"started",get:function(){return null!==this.we}},{key:"_e",value:function(e){var t=this,n=this.de?3e5:6e4;D("LruGarbageCollector","Garbage collection scheduled in ".concat(n,"ms")),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.we=null,t.de=!0,n.prev=1,n.next=4,e.collectGarbage(t.garbageCollector);case 4:n.next=14;break;case 6:if(n.prev=6,n.t0=n.catch(1),!Vr(n.t0)){n.next=12;break}D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n.t0),n.next=14;break;case 12:return n.next=14,Si(n.t0);case 14:return n.next=16,t._e(e);case 16:case"end":return n.stop()}}),n,null,[[1,6]])}))))}}]),e}(),Zi=function(){function e(t,n){(0,h.Z)(this,e),this.me=t,this.params=n}return(0,d.Z)(e,[{key:"calculateTargetCount",value:function(e,t){return this.me.ge(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return Lr.resolve(Q.T);var r=new Ai(t);return this.me.forEachTarget(e,(function(e){return r.fe(e.sequenceNumber)})).next((function(){return n.me.ye(e,(function(e){return r.fe(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.me.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.me.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; disabled"),Lr.resolve(hi)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),hi):n.pe(e,t)}))}},{key:"getCacheSize",value:function(e){return this.me.getCacheSize(e)}},{key:"pe",value:function(e,t){var n,r,i,a,u,o,s,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,u=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,o=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return s=Date.now(),_()<=g.in.DEBUG&&D("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(u-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(o-u)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(s-o)+"ms\n"+"Total Duration: ".concat(s-l,"ms")),Lr.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}(),Ci=function(){function e(t,n){(0,h.Z)(this,e),this.db=t,this.garbageCollector=function(e,t){return new Zi(e,t)}(this,n)}return(0,d.Z)(e,[{key:"ge",value:function(e){var t=this.Te(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"Te",value:function(e){var t=0;return this.ye(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"ye",value:function(e,t){return this.Ee(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return Li(e,n)}},{key:"removeReference",value:function(e,t,n){return Li(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Li(e,t)}},{key:"Ie",value:function(e,t){return function(e,t){var n=!1;return wi(e).jt((function(r){return mi(e,r,t).next((function(e){return e&&(n=!0),Lr.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Ee(e,(function(u,o){if(o<=t){var s=n.Ie(e,u).next((function(t){if(!t)return a++,r.getEntry(e,u).next((function(){return r.removeEntry(u),Ei(e).delete([0,lr(u.path)])}))}));i.push(s)}})).next((function(){return Lr.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Li(e,t)}},{key:"Ee",value:function(e,t){var n,r=Ei(e),i=Q.T;return r.Kt({index:Tr.documentTargetsIndex},(function(e,r){var u=(0,a.Z)(e,2),o=u[0],s=(u[1],r.path),c=r.sequenceNumber;0===o?(i!==Q.T&&t(new be(dr(n)),i),i=c,n=s):i=Q.T})).next((function(){i!==Q.T&&t(new be(dr(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Li(e,t){return Ei(e).put(function(e,t){return new Tr(0,lr(e.path),t)}(t,e.currentSequenceNumber))}var Ri=function(){function e(t,n){(0,h.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return(0,d.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var u=(0,a.Z)(r.value,2),o=u[0],s=u[1];if(this.equalsFn(o,e))return s}}catch(c){i.e(c)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}},{key:"forEach",value:function(e){ne(this.inner,(function(t,n){var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var u=(0,a.Z)(r.value,2),o=u[0],s=u[1];e(o,s)}}catch(c){i.e(c)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return re(this.inner)}}]),e}(),Fi=function(){function e(){(0,h.Z)(this,e),this.changes=new Ri((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,d.Z)(e,[{key:"getReadTime",value:function(e){var t=this.changes.get(e);return t?t.readTime:ee.min()}},{key:"addEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}},{key:"removeEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.assertNotApplied(),this.changes.set(e,{document:Ve.newInvalidDocument(e),readTime:t})}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Lr.resolve(n.document):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Mi=function(){function e(t,n){(0,h.Z)(this,e),this.N=t,this.Ht=n}return(0,d.Z)(e,[{key:"addEntry",value:function(e,t,n){return Pi(e).put(qi(t),n)}},{key:"removeEntry",value:function(e,t){var n=Pi(e),r=qi(t);return n.delete(r)}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.Ae(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this;return Pi(e).get(qi(t)).next((function(e){return n.Re(t,e)}))}},{key:"be",value:function(e,t){var n=this;return Pi(e).get(qi(t)).next((function(e){return{document:n.Re(t,e),size:yi(e)}}))}},{key:"getEntries",value:function(e,t){var n=this,r=hn();return this.Pe(e,t,(function(e,t){var i=n.Re(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"ve",value:function(e,t){var n=this,r=hn(),i=new un(be.comparator);return this.Pe(e,t,(function(e,t){var a=n.Re(e,t);r=r.insert(e,a),i=i.insert(e,yi(t))})).next((function(){return{documents:r,Ve:i}}))}},{key:"Pe",value:function(e,t,n){if(t.isEmpty())return Lr.resolve();var r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator(),a=i.getNext();return Pi(e).Kt({range:r},(function(e,t,r){for(var u=be.fromSegments(e);a&&be.comparator(a,u)<0;)n(a,null),a=i.getNext();a&&a.isEqual(u)&&(n(a,t),a=i.hasNext()?i.getNext():null),a?r.Mt(a.path.toArray()):r.done()})).next((function(){for(;a;)n(a,null),a=i.hasNext()?i.getNext():null}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){var r=this,i=hn(),a=t.path.length+1,u={};if(n.isEqual(ee.min())){var o=t.path.toArray();u.range=IDBKeyRange.lowerBound(o)}else{var s=t.path.toArray(),c=Jr(n);u.range=IDBKeyRange.lowerBound([s,c],!0),u.index=br.collectionReadTimeIndex}return Pi(e).Kt(u,(function(e,n,u){if(e.length===a){var o=Wr(r.N,n);t.path.isPrefixOf(o.key.path)?kt(t,o)&&(i=i.insert(o.key,o)):u.done()}})).next((function(){return i}))}},{key:"newChangeBuffer",value:function(e){return new Oi(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return Vi(e).get(xr.key).next((function(e){return F(!!e),e}))}},{key:"Ae",value:function(e,t){return Vi(e).put(xr.key,t)}},{key:"Re",value:function(e,t){if(t){var n=Wr(this.N,t);if(!n.isNoDocument()||!n.version.isEqual(ee.min()))return n}return Ve.newInvalidDocument(e)}}]),e}(),Oi=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).Se=e,i.trackRemovals=r,i.De=new Ri((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return(0,d.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new cn((function(e,t){return Y(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,u){var o=t.De.get(a);if(u.document.isValidDocument()){var s=Yr(t.Se.N,u.document,t.getReadTime(a));i=i.add(a.path.popLast());var c=yi(s);r+=c-o,n.push(t.Se.addEntry(e,a,s))}else if(r-=o,t.trackRemovals){var l=Yr(t.Se.N,Ve.newNoDocument(a,ee.min()),t.getReadTime(a));n.push(t.Se.addEntry(e,a,l))}else n.push(t.Se.removeEntry(e,a))})),i.forEach((function(r){n.push(t.Se.Ht.addToCollectionParentIndex(e,r))})),n.push(this.Se.updateMetadata(e,r)),Lr.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.Se.be(e,t).next((function(e){return n.De.set(t,e.size),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.Se.ve(e,t).next((function(e){var t=e.documents;return e.Ve.forEach((function(e,t){n.De.set(e,t)})),t}))}}]),n}(Fi);function Vi(e){return zr(e,xr.store)}function Pi(e){return zr(e,br.store)}function qi(e){return e.path.toArray()}var Ui=function(){function e(t){(0,h.Z)(this,e),this.N=t}return(0,d.Z)(e,[{key:"Ct",value:function(e,t,n,r){var i=this;F(n<r&&n>=0&&r<=11);var a=new Rr("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(yr.store)}(e),function(e){e.createObjectStore(pr.store,{keyPath:pr.keyPath}),e.createObjectStore(mr.store,{keyPath:mr.keyPath,autoIncrement:!0}).createIndex(mr.userMutationsIndex,mr.userMutationsKeyPath,{unique:!0}),e.createObjectStore(gr.store)}(e),Bi(e),function(e){e.createObjectStore(br.store)}(e));var u=Lr.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Tr.store),e.deleteObjectStore(Ir.store),e.deleteObjectStore(Er.store)}(e),Bi(e)),u=u.next((function(){return function(e){var t=e.store(Er.store),n=new Er(0,0,ee.min().toTimestamp(),0);return t.put(Er.key,n)}(a)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(e,t){return t.store(mr.store).Lt().next((function(n){e.deleteObjectStore(mr.store),e.createObjectStore(mr.store,{keyPath:mr.keyPath,autoIncrement:!0}).createIndex(mr.userMutationsIndex,mr.userMutationsKeyPath,{unique:!0});var r=t.store(mr.store),i=n.map((function(e){return r.put(e)}));return Lr.waitFor(i)}))}(e,a)}))),u=u.next((function(){!function(e){e.createObjectStore(Nr.store,{keyPath:Nr.keyPath})}(e)}))),n<5&&r>=5&&(u=u.next((function(){return i.Ce(a)}))),n<6&&r>=6&&(u=u.next((function(){return function(e){e.createObjectStore(xr.store)}(e),i.Ne(a)}))),n<7&&r>=7&&(u=u.next((function(){return i.xe(a)}))),n<8&&r>=8&&(u=u.next((function(){return i.ke(e,a)}))),n<9&&r>=9&&(u=u.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){var t=e.objectStore(br.store);t.createIndex(br.readTimeIndex,br.readTimeIndexPath,{unique:!1}),t.createIndex(br.collectionReadTimeIndex,br.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(u=u.next((function(){return i.$e(a)}))),n<11&&r>=11&&(u=u.next((function(){!function(e){e.createObjectStore(_r.store,{keyPath:_r.keyPath})}(e),function(e){e.createObjectStore(Ar.store,{keyPath:Ar.keyPath})}(e)}))),u}},{key:"Ne",value:function(e){var t=0;return e.store(br.store).Kt((function(e,n){t+=yi(n)})).next((function(){var n=new xr(t);return e.store(xr.store).put(xr.key,n)}))}},{key:"Ce",value:function(e){var t=this,n=e.store(pr.store),r=e.store(mr.store);return n.Lt().next((function(n){return Lr.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Lt(mr.userMutationsIndex,i).next((function(r){return Lr.forEach(r,(function(r){F(r.userId===n.userId);var i=ti(t.N,r);return vi(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"xe",value:function(e){var t=e.store(Tr.store),n=e.store(br.store);return e.store(Er.store).get(Er.key).next((function(e){var r=[];return n.Kt((function(n,i){var a=new ae(n),u=function(e){return[0,lr(e)]}(a);r.push(t.get(u).next((function(n){return n?Lr.resolve():function(n){return t.put(new Tr(0,lr(n),e.highestListenSequenceNumber))}(a)})))})).next((function(){return Lr.waitFor(r)}))}))}},{key:"ke",value:function(e,t){e.createObjectStore(Sr.store,{keyPath:Sr.keyPath});var n=t.store(Sr.store),r=new ci,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:lr(i)})}};return t.store(br.store).Kt({qt:!0},(function(e,t){var n=new ae(e);return i(n.popLast())})).next((function(){return t.store(gr.store).Kt({qt:!0},(function(e,t){var n=(0,a.Z)(e,3),r=(n[0],n[1]),u=(n[2],dr(r));return i(u.popLast())}))}))}},{key:"$e",value:function(e){var t=this,n=e.store(Ir.store);return n.Kt((function(e,r){var i=ni(r),a=ri(t.N,i);return n.put(a)}))}}]),e}();function Bi(e){e.createObjectStore(Tr.store,{keyPath:Tr.keyPath}).createIndex(Tr.documentTargetsIndex,Tr.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Ir.store,{keyPath:Ir.keyPath}).createIndex(Ir.queryTargetsIndexName,Ir.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Er.store)}var Ki="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",zi=function(){function e(t,n,r,i,a,u,o,s,c,l){if((0,h.Z)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Oe=a,this.window=u,this.document=o,this.Fe=c,this.Me=l,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=function(e){return Promise.resolve()},!e.bt())throw new P(V.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ci(this,i),this.We=n+"main",this.N=new Hr(s),this.Ge=new Fr(this.We,11,new Ui(this.N)),this.ze=new xi(this.referenceDelegate,this.N),this.Ht=new li,this.He=function(e,t){return new Mi(e,t)}(this.N,this.Ht),this.Je=new ai,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===l&&Z("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}var t,n;return(0,d.Z)(e,[{key:"start",value:function(){var e=this;return this.Xe().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new P(V.FAILED_PRECONDITION,Ki);return e.Ze(),e.tn(),e.en(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.ze.getHighestSequenceNumber(t)}))})).then((function(t){e.Le=new Q(t,e.Fe)})).then((function(){e.Be=!0})).catch((function(t){return e.Ge&&e.Ge.close(),Promise.reject(t)}))}},{key:"nn",value:function(e){var t=this;return this.Qe=function(){var n=(0,u.Z)(y().mark((function n(r){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.Ge.xt(function(){var t=(0,u.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.Xe();case 4:case"end":return e.stop()}}),e)})))))}},{key:"Xe",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return ji(t).put(new Nr(e.clientId,Date.now(),e.networkEnabled,e.inForeground)).next((function(){if(e.isPrimary)return e.sn(t).next((function(t){t||(e.isPrimary=!1,e.Oe.enqueueRetryable((function(){return e.Qe(!1)})))}))})).next((function(){return e.rn(t)})).next((function(n){return e.isPrimary&&!n?e.on(t).next((function(){return!1})):!!n&&e.an(t).next((function(){return!0}))}))})).catch((function(t){if(Vr(t))return D("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return D("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.Oe.enqueueRetryable((function(){return e.Qe(t)})),e.isPrimary=t}))}},{key:"sn",value:function(e){var t=this;return Gi(e).get(yr.key).next((function(e){return Lr.resolve(t.cn(e))}))}},{key:"un",value:function(e){return ji(e).delete(this.clientId)}},{key:"hn",value:(n=(0,u.Z)(y().mark((function e(){var t,n,r,i,a=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.ln(this.je,18e5)){e.next=6;break}return this.je=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=zr(e,Nr.store);return t.Lt().next((function(e){var n=a.fn(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return Lr.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.Ye){n=b(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.Ye.removeItem(this.dn(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"en",value:function(){var e=this;this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.Xe().then((function(){return e.hn()})).then((function(){return e.en()}))}))}},{key:"cn",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"rn",value:function(e){var t=this;return this.Me?Lr.resolve(!0):Gi(e).get(yr.key).next((function(n){if(null!==n&&t.ln(n.leaseTimestampMs,5e3)&&!t.wn(n.ownerId)){if(t.cn(n)&&t.networkEnabled)return!0;if(!t.cn(n)){if(!n.allowTabSynchronization)throw new P(V.FAILED_PRECONDITION,Ki);return!1}}return!(!t.networkEnabled||!t.inForeground)||ji(e).Lt().next((function(e){return void 0===t.fn(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&D("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:(t=(0,u.Z)(y().mark((function e(){var t=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),e.next=7,this.Ge.runTransaction("shutdown","readwrite",[yr.store,Nr.store],(function(e){var n=new Kr(e,Q.T);return t.on(n).next((function(){return t.un(n)}))}));case 7:this.Ge.close(),this.yn();case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"fn",value:function(e,t){var n=this;return e.filter((function(e){return n.ln(e.updateTimeMs,t)&&!n.wn(e.clientId)}))}},{key:"pn",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return ji(t).Lt().next((function(t){return e.fn(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.Be}},{key:"getMutationQueue",value:function(e){return pi.Yt(e,this.N,this.Ht,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.ze}},{key:"getRemoteDocumentCache",value:function(){return this.He}},{key:"getIndexManager",value:function(){return this.Ht}},{key:"getBundleCache",value:function(){return this.Je}},{key:"runTransaction",value:function(e,t,n){var r=this;D("IndexedDbPersistence","Starting transaction:",e);var i,a="readonly"===t?"readonly":"readwrite";return this.Ge.runTransaction(e,a,Dr,(function(a){return i=new Kr(a,r.Le?r.Le.next():Q.T),"readwrite-primary"===t?r.sn(i).next((function(e){return!!e||r.rn(i)})).next((function(t){if(!t)throw Z("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.Oe.enqueueRetryable((function(){return r.Qe(!1)})),new P(V.FAILED_PRECONDITION,Zr);return n(i)})).next((function(e){return r.an(i).next((function(){return e}))})):r.Tn(i).next((function(){return n(i)}))})).then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Tn",value:function(e){var t=this;return Gi(e).get(yr.key).next((function(e){if(null!==e&&t.ln(e.leaseTimestampMs,5e3)&&!t.wn(e.ownerId)&&!t.cn(e)&&!(t.Me||t.allowTabSynchronization&&e.allowTabSynchronization))throw new P(V.FAILED_PRECONDITION,Ki)}))}},{key:"an",value:function(e){var t=new yr(this.clientId,this.allowTabSynchronization,Date.now());return Gi(e).put(yr.key,t)}},{key:"on",value:function(e){var t=this,n=Gi(e);return n.get(yr.key).next((function(e){return t.cn(e)?(D("IndexedDbPersistence","Releasing primary lease."),n.delete(yr.key)):Lr.resolve()}))}},{key:"ln",value:function(e,t){var n=Date.now();return!(e<n-t||e>n&&(Z("Detected an update time that is in the future: ".concat(e," > ").concat(n)),1))}},{key:"Ze",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=function(){e.Oe.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.Xe()}))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}},{key:"mn",value:function(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}},{key:"tn",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=function(){t._n(),(0,k.G6)()&&navigator.appVersion.match("Version/14")&&t.Oe.enterRestrictedMode(!0),t.Oe.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.Ue))}},{key:"gn",value:function(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}},{key:"wn",value:function(e){var t;try{var n=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return D("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Z("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"_n",value:function(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(Bl){Z("Failed to set zombie client id.",Bl)}}},{key:"yn",value:function(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(Bl){}}},{key:"dn",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"bt",value:function(){return Fr.bt()}}]),e}();function Gi(e){return zr(e,yr.store)}function ji(e){return zr(e,Nr.store)}function Qi(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var Hi=function e(t,n){(0,h.Z)(this,e),this.progress=t,this.En=n},Wi=function(){function e(t,n,r){(0,h.Z)(this,e),this.He=t,this.In=n,this.Ht=r}return(0,d.Z)(e,[{key:"An",value:function(e,t){var n=this;return this.In.getAllMutationBatchesAffectingDocumentKey(e,t).next((function(r){return n.Rn(e,t,r)}))}},{key:"Rn",value:function(e,t,n){return this.He.getEntry(e,t).next((function(e){var t,r=b(n);try{for(r.s();!(t=r.n()).done;){t.value.applyToLocalView(e)}}catch(i){r.e(i)}finally{r.f()}return e}))}},{key:"bn",value:function(e,t){e.forEach((function(e,n){var r,i=b(t);try{for(i.s();!(r=i.n()).done;){r.value.applyToLocalView(n)}}catch(a){i.e(a)}finally{i.f()}}))}},{key:"Pn",value:function(e,t){var n=this;return this.He.getEntries(e,t).next((function(t){return n.vn(e,t).next((function(){return t}))}))}},{key:"vn",value:function(e,t){var n=this;return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){return n.bn(t,e)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return be.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Vn(e,t.path):ht(t)?this.Sn(e,t,n):this.Dn(e,t,n)}},{key:"Vn",value:function(e,t){return this.An(e,new be(t)).next((function(e){var t=vn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"Sn",value:function(e,t,n){var r=this,i=t.collectionGroup,a=vn();return this.Ht.getCollectionParents(e,i).next((function(u){return Lr.forEach(u,(function(u){var o=function(e,t){return new at(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,u.child(i));return r.Dn(e,o,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"Dn",value:function(e,t,n){var r,i,a=this;return this.He.getDocumentsMatchingQuery(e,t,n).next((function(n){return r=n,a.In.getAllMutationBatchesAffectingQuery(e,t)})).next((function(t){return i=t,a.Cn(e,i,r).next((function(e){r=e;var t,n=b(i);try{for(n.s();!(t=n.n()).done;){var a,u=t.value,o=b(u.mutations);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=s.key,l=r.get(c);null==l&&(l=Ve.newInvalidDocument(c),r=r.insert(c,l)),Kt(s,l,u.localWriteTime),l.isFoundDocument()||(r=r.remove(c))}}catch(f){o.e(f)}finally{o.f()}}}catch(f){n.e(f)}finally{n.f()}}))})).next((function(){return r.forEach((function(e,n){kt(t,n)||(r=r.remove(e))})),r}))}},{key:"Cn",value:function(e,t,n){var r,i=gn(),a=b(t);try{for(a.s();!(r=a.n()).done;){var u,o=b(r.value.mutations);try{for(o.s();!(u=o.n()).done;){var s=u.value;s instanceof Ht&&null===n.get(s.key)&&(i=i.add(s.key))}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}var c=n;return this.He.getEntries(e,i).next((function(e){return e.forEach((function(e,t){t.isFoundDocument()&&(c=c.insert(e,t))})),c}))}}]),e}(),Yi=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.targetId=t,this.fromCache=n,this.Nn=r,this.xn=i}return(0,d.Z)(e,null,[{key:"kn",value:function(t,n){var r,i=gn(),a=gn(),u=b(n.docChanges);try{for(u.s();!(r=u.n()).done;){var o=r.value;switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}}}catch(s){u.e(s)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),Ji=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"$n",value:function(e){this.On=e}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(ee.min())?this.Fn(e,t):this.On.Pn(e,r).next((function(a){var u=i.Mn(t,a);return(st(t)||ct(t))&&i.Ln(t.limitType,u,r,n)?i.Fn(e,t):(_()<=g.in.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),gt(t)),i.On.getDocumentsMatchingQuery(e,t,n).next((function(e){return u.forEach((function(t){e=e.insert(t.key,t)})),e})))}))}},{key:"Mn",value:function(e,t){var n=new cn(wt(e));return t.forEach((function(t,r){kt(e,r)&&(n=n.add(r))})),n}},{key:"Ln",value:function(e,t,n,r){if(n.size!==t.size)return!0;var i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Fn",value:function(e,t){return _()<=g.in.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",gt(t)),this.On.getDocumentsMatchingQuery(e,t,ee.min())}}]),e}(),Xi=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.persistence=t,this.Bn=n,this.N=i,this.Un=new un(Y),this.qn=new Ri((function(e){return Ue(e)}),Be),this.Kn=ee.min(),this.In=t.getMutationQueue(r),this.jn=t.getRemoteDocumentCache(),this.ze=t.getTargetCache(),this.Qn=new Wi(this.jn,this.In,this.persistence.getIndexManager()),this.Je=t.getBundleCache(),this.Bn.$n(this.Qn)}return(0,d.Z)(e,[{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.Un)}))}}]),e}();function $i(e,t,n,r){return new Xi(e,t,n,r)}function ea(e,t){return ta.apply(this,arguments)}function ta(){return(ta=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=r.In,a=r.Qn,e.next=4,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.In.getAllMutationBatches(e).next((function(u){return t=u,i=r.persistence.getMutationQueue(n),a=new Wi(r.jn,i,r.persistence.getIndexManager()),i.getAllMutationBatches(e)})).next((function(n){var r,i=[],u=[],o=gn(),s=b(t);try{for(s.s();!(r=s.n()).done;){var c=r.value;i.push(c.batchId);var l,f=b(c.mutations);try{for(f.s();!(l=f.n()).done;){var h=l.value;o=o.add(h.key)}}catch(k){f.e(k)}finally{f.f()}}}catch(k){s.e(k)}finally{s.f()}var d,v=b(n);try{for(v.s();!(d=v.n()).done;){var y=d.value;u.push(y.batchId);var p,m=b(y.mutations);try{for(m.s();!(p=m.n()).done;){var g=p.value;o=o.add(g.key)}}catch(k){m.e(k)}finally{m.f()}}}catch(k){v.e(k)}finally{v.f()}return a.Pn(e,o).next((function(e){return{Wn:e,removedBatchIds:i,addedBatchIds:u}}))}))}));case 4:return u=e.sent,e.abrupt("return",(r.In=i,r.Qn=a,r.Bn.$n(r.Qn),u));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function na(e,t){var n=O(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=Lr.resolve();return a.forEach((function(e){u=u.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);F(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),u.next((function(){return e.In.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.In.performConsistencyCheck(e)})).next((function(){return n.Qn.Pn(e,r)}))}))}function ra(e){var t=O(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.ze.getLastRemoteSnapshotVersion(e)}))}function ia(e,t){var n=O(e),r=t.snapshotVersion,i=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.jn.newChangeBuffer({trackRemovals:!0});i=n.Un;var u=[];t.targetChanges.forEach((function(t,a){var o=i.get(a);if(o){u.push(n.ze.removeMatchingKeys(e,t.removedDocuments,a).next((function(){return n.ze.addMatchingKeys(e,t.addedDocuments,a)})));var s=t.resumeToken;if(s.approximateByteSize()>0){var c=o.withResumeToken(s,r).withSequenceNumber(e.currentSequenceNumber);i=i.insert(a,c),function(e,t,n){return F(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(o,c,t)&&u.push(n.ze.updateTargetData(e,c))}}}));var o=hn();if(t.documentUpdates.forEach((function(r,i){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),u.push(aa(e,a,t.documentUpdates,r,void 0).next((function(e){o=e}))),!r.isEqual(ee.min())){var s=n.ze.getLastRemoteSnapshotVersion(e).next((function(t){return n.ze.setTargetsMetadata(e,e.currentSequenceNumber,r)}));u.push(s)}return Lr.waitFor(u).next((function(){return a.apply(e)})).next((function(){return n.Qn.vn(e,o)})).next((function(){return o}))})).then((function(e){return n.Un=i,e}))}function aa(e,t,n,r,i){var a=gn();return n.forEach((function(e){return a=a.add(e)})),t.getEntries(e,a).next((function(e){var a=hn();return n.forEach((function(n,u){var o=e.get(n),s=(null==i?void 0:i.get(n))||r;u.isNoDocument()&&u.version.isEqual(ee.min())?(t.removeEntry(n,s),a=a.insert(n,u)):!o.isValidDocument()||u.version.compareTo(o.version)>0||0===u.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(u,s),a=a.insert(n,u)):D("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",u.version)})),a}))}function ua(e,t){var n=O(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)}))}function oa(e,t){var n=O(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.ze.getTargetData(e,t).next((function(i){return i?(r=i,Lr.resolve(r)):n.ze.allocateTargetId(e).next((function(i){return r=new Qr(t,i,0,e.currentSequenceNumber),n.ze.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.Un.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Un=n.Un.insert(e.targetId,e),n.qn.set(t,e.targetId)),e}))}function sa(e,t,n){return ca.apply(this,arguments)}function ca(){return(ca=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=O(t),a=i.Un.get(n),u=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",u,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Vr(e.t1)){e.next=12;break}throw e.t1;case 12:D("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.Un=i.Un.remove(n),i.qn.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function la(e,t,n){var r=O(e),i=ee.min(),a=gn();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=O(e),i=r.qn.get(n);return void 0!==i?Lr.resolve(r.Un.get(i)):r.ze.getTargetData(t,n)}(r,e,vt(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.ze.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Bn.getDocumentsMatchingQuery(e,t,n?i:ee.min(),n?a:gn())})).next((function(e){return{documents:e,Gn:a}}))}))}function fa(e,t){var n=O(e),r=O(n.ze),i=n.Un.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.Tt(e,t).next((function(e){return e?e.target:null}))}))}function ha(e){var t=O(e);return t.persistence.runTransaction("Get new document changes","readonly",(function(e){return function(e,t,n){var r=O(e),i=hn(),a=Jr(n),u=Pi(t),o=IDBKeyRange.lowerBound(a,!0);return u.Kt({index:br.readTimeIndex,range:o},(function(e,t){var n=Wr(r.N,t);i=i.insert(n.key,n),a=t.readTime})).next((function(){return{En:i,readTime:Xr(a)}}))}(t.jn,e,t.Kn)})).then((function(e){var n=e.En,r=e.readTime;return t.Kn=r,n}))}function da(e){return va.apply(this,arguments)}function va(){return(va=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O(t),e.abrupt("return",n.persistence.runTransaction("Synchronize last document change read time","readonly",(function(e){return function(e){var t=Pi(e),n=ee.min();return t.Kt({index:br.readTimeIndex,reverse:!0},(function(e,t,r){t.readTime&&(n=Xr(t.readTime)),r.done()})).next((function(){return n}))}(e)})).then((function(e){n.Kn=e})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ya(e,t,n,r){return pa.apply(this,arguments)}function pa(){return(pa=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o,s,c,l,f,h,d,v;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=O(t),u=gn(),o=hn(),s=pn(),c=b(r);try{for(c.s();!(l=c.n()).done;)f=l.value,h=n.zn(f.metadata.name),f.document&&(u=u.add(h)),o=o.insert(h,n.Hn(f)),s=s.insert(h,n.Jn(f.metadata.readTime))}catch(y){c.e(y)}finally{c.f()}return d=a.jn.newChangeBuffer({trackRemovals:!0}),e.next=7,oa(a,function(e){return vt(ot(ae.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return v=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return aa(e,d,o,ee.min(),s).next((function(t){return d.apply(e),t})).next((function(t){return a.ze.removeMatchingKeysForTargetId(e,v.targetId).next((function(){return a.ze.addMatchingKeys(e,u,v.targetId)})).next((function(){return a.Qn.vn(e,t)})).next((function(){return t}))}))})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ma(e,t){return ga.apply(this,arguments)}function ga(){return ga=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:gn(),e.next=3,oa(t,vt(ii(n.bundledQuery)));case 3:return i=e.sent,a=O(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Mn(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Je.saveNamedQuery(e,n);var u=i.withResumeToken(le.EMPTY_BYTE_STRING,t);return a.Un=a.Un.insert(u.targetId,u),a.ze.updateTargetData(e,u).next((function(){return a.ze.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.ze.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Je.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),ga.apply(this,arguments)}var ka=function(){function e(t){(0,h.Z)(this,e),this.N=t,this.Yn=new Map,this.Xn=new Map}return(0,d.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Lr.resolve(this.Yn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Yn.set(t.id,{id:(n=t).id,version:n.version,createTime:Mn(n.createTime)}),Lr.resolve()}},{key:"getNamedQuery",value:function(e,t){return Lr.resolve(this.Xn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Xn.set(t.name,function(e){return{name:e.name,query:ii(e.bundledQuery),readTime:Mn(e.readTime)}}(t)),Lr.resolve()}}]),e}(),wa=function(){function e(){(0,h.Z)(this,e),this.Zn=new cn(ba.ts),this.es=new cn(ba.ns)}return(0,d.Z)(e,[{key:"isEmpty",value:function(){return this.Zn.isEmpty()}},{key:"addReference",value:function(e,t){var n=new ba(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}},{key:"ss",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.rs(new ba(e,t))}},{key:"os",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"cs",value:function(e){var t=this,n=new be(new ae([])),r=new ba(n,e),i=new ba(n,e+1),a=[];return this.es.forEachInRange([r,i],(function(e){t.rs(e),a.push(e.key)})),a}},{key:"us",value:function(){var e=this;this.Zn.forEach((function(t){return e.rs(t)}))}},{key:"rs",value:function(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}},{key:"hs",value:function(e){var t=new be(new ae([])),n=new ba(t,e),r=new ba(t,e+1),i=gn();return this.es.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new ba(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),ba=function(){function e(t,n){(0,h.Z)(this,e),this.key=t,this.ls=n}return(0,d.Z)(e,null,[{key:"ts",value:function(e,t){return be.comparator(e.key,t.key)||Y(e.ls,t.ls)}},{key:"ns",value:function(e,t){return Y(e.ls,t.ls)||be.comparator(e.key,t.key)}}]),e}(),xa=function(){function e(t,n){(0,h.Z)(this,e),this.Ht=t,this.referenceDelegate=n,this.In=[],this.fs=1,this.ds=new cn(ba.ts)}return(0,d.Z)(e,[{key:"checkEmpty",value:function(e){return Lr.resolve(0===this.In.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.fs;this.fs++,this.In.length>0&&this.In[this.In.length-1];var a=new Gr(i,t,n,r);this.In.push(a);var u,o=b(r);try{for(o.s();!(u=o.n()).done;){var s=u.value;this.ds=this.ds.add(new ba(s.key,i)),this.Ht.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(c){o.e(c)}finally{o.f()}return Lr.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Lr.resolve(this.ws(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this._s(n),i=r<0?0:r;return Lr.resolve(this.In.length>i?this.In[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Lr.resolve(0===this.In.length?-1:this.fs-1)}},{key:"getAllMutationBatches",value:function(e){return Lr.resolve(this.In.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new ba(t,0),i=new ba(t,Number.POSITIVE_INFINITY),a=[];return this.ds.forEachInRange([r,i],(function(e){var t=n.ws(e.ls);a.push(t)})),Lr.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new cn(Y);return t.forEach((function(e){var t=new ba(e,0),i=new ba(e,Number.POSITIVE_INFINITY);n.ds.forEachInRange([t,i],(function(e){r=r.add(e.ls)}))})),Lr.resolve(this.gs(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;be.isDocumentKey(i)||(i=i.child(""));var a=new ba(new be(i),0),u=new cn(Y);return this.ds.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.ls)),!0)}),a),Lr.resolve(this.gs(u))}},{key:"gs",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.ws(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;F(0===this.ys(t.batchId,"removed")),this.In.shift();var r=this.ds;return Lr.forEach(t.mutations,(function(i){var a=new ba(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.ds=r}))}},{key:"te",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new ba(t,0),r=this.ds.firstAfterOrEqual(n);return Lr.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.In.length,Lr.resolve()}},{key:"ys",value:function(e,t){return this._s(e)}},{key:"_s",value:function(e){return 0===this.In.length?0:e-this.In[0].batchId}},{key:"ws",value:function(e){var t=this._s(e);return t<0||t>=this.In.length?null:this.In[t]}}]),e}(),Ia=function(){function e(t,n){(0,h.Z)(this,e),this.Ht=t,this.ps=n,this.docs=new un(be.comparator),this.size=0}return(0,d.Z)(e,[{key:"addEntry",value:function(e,t,n){var r=t.key,i=this.docs.get(r),a=i?i.size:0,u=this.ps(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:u,readTime:n}),this.size+=u-a,this.Ht.addToCollectionParentIndex(e,r.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Lr.resolve(n?n.document.clone():Ve.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=hn();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.clone():Ve.newInvalidDocument(e))})),Lr.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){for(var r=hn(),i=new be(t.path.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var u=a.getNext(),o=u.key,s=u.value,c=s.document,l=s.readTime;if(!t.path.isPrefixOf(o.path))break;l.compareTo(n)<=0||kt(t,c)&&(r=r.insert(c.key,c.clone()))}return Lr.resolve(r)}},{key:"Ts",value:function(e,t){return Lr.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new Ta(this)}},{key:"getSize",value:function(e){return Lr.resolve(this.size)}}]),e}(),Ta=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).Se=e,r}return(0,d.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(t.Se.addEntry(e,i.document,t.getReadTime(r))):t.Se.removeEntry(r)})),Lr.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.Se.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.Se.getEntries(e,t)}}]),n}(Fi),Ea=function(){function e(t){(0,h.Z)(this,e),this.persistence=t,this.Es=new Ri((function(e){return Ue(e)}),Be),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this.Is=0,this.As=new wa,this.targetCount=0,this.Rs=bi.se()}return(0,d.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Es.forEach((function(e,n){return t(n)})),Lr.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Lr.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Lr.resolve(this.Is)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Rs.next(),Lr.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),Lr.resolve()}},{key:"ae",value:function(e){this.Es.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new bi(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.ae(t),this.targetCount+=1,Lr.resolve()}},{key:"updateTargetData",value:function(e,t){return this.ae(t),Lr.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Es.delete(t.target),this.As.cs(t.targetId),this.targetCount-=1,Lr.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Es.forEach((function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.Es.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Lr.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return Lr.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Es.get(t)||null;return Lr.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.As.ss(t,n),Lr.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.As.os(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),Lr.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.As.cs(t),Lr.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.As.hs(t);return Lr.resolve(n)}},{key:"containsKey",value:function(e,t){return Lr.resolve(this.As.containsKey(t))}}]),e}(),Sa=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.bs={},this.Le=new Q(0),this.Be=!1,this.Be=!0,this.referenceDelegate=t(this),this.ze=new Ea(this),this.Ht=new si,this.He=function(e,t){return new Ia(e,(function(e){return r.referenceDelegate.Ps(e)}))}(this.Ht),this.N=new Hr(n),this.Je=new ka(this.N)}return(0,d.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Be=!1,Promise.resolve()}},{key:"started",get:function(){return this.Be}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(){return this.Ht}},{key:"getMutationQueue",value:function(e){var t=this.bs[e.toKey()];return t||(t=new xa(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=t),t}},{key:"getTargetCache",value:function(){return this.ze}},{key:"getRemoteDocumentCache",value:function(){return this.He}},{key:"getBundleCache",value:function(){return this.Je}},{key:"runTransaction",value:function(e,t,n){var r=this;D("MemoryPersistence","Starting transaction:",e);var i=new Na(this.Le.next());return this.referenceDelegate.vs(),n(i).next((function(e){return r.referenceDelegate.Vs(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ss",value:function(e,t){return Lr.or(Object.values(this.bs).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),Na=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return n}(Cr),_a=function(){function e(t){(0,h.Z)(this,e),this.persistence=t,this.Ds=new wa,this.Cs=null}return(0,d.Z)(e,[{key:"xs",get:function(){if(this.Cs)return this.Cs;throw R()}},{key:"addReference",value:function(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),Lr.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),Lr.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.xs.add(t.toString()),Lr.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Ds.cs(t.targetId).forEach((function(e){return n.xs.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.xs.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"vs",value:function(){this.Cs=new Set}},{key:"Vs",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Lr.forEach(this.xs,(function(r){var i=be.fromPath(r);return t.ks(e,i).next((function(e){e||n.removeEntry(i)}))})).next((function(){return t.Cs=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.ks(e,t).next((function(e){e?n.xs.delete(t.toString()):n.xs.add(t.toString())}))}},{key:"Ps",value:function(e){return 0}},{key:"ks",value:function(e,t){var n=this;return Lr.or([function(){return Lr.resolve(n.Ds.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ss(e,t)}])}}],[{key:"Ns",value:function(t){return new e(t)}}]),e}();function Aa(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Da(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Za(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Ca=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return(0,d.Z)(e,[{key:"Os",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"$s",value:function(t,n,r){var i,a=JSON.parse(r),u="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return u&&a.error&&((u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new P(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(Z("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),La=function(){function e(t,n,r){(0,h.Z)(this,e),this.targetId=t,this.state=n,this.error=r}return(0,d.Z)(e,[{key:"Os",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"$s",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new P(i.error.code,i.error.message))),a?new e(t,i.state,r):(Z("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Ra=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.activeTargetIds=n}return(0,d.Z)(e,null,[{key:"$s",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=wn(),u=0;i&&u<r.activeTargetIds.length;++u)i=we(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(Z("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),Fa=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.onlineState=n}return(0,d.Z)(e,null,[{key:"$s",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(Z("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),Ma=function(){function e(){(0,h.Z)(this,e),this.activeTargetIds=wn()}return(0,d.Z)(e,[{key:"Fs",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Ms",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Os",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),Oa=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.window=t,this.Oe=n,this.persistenceKey=r,this.Ls=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new un(Y),this.started=!1,this.Ks=[];var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.js=Aa(this.persistenceKey,this.Ls),this.Qs=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.qs=this.qs.insert(this.Ls,new Ma),this.Ws=new RegExp("^firestore_clients_".concat(u,"_([^_]*)$")),this.Gs=new RegExp("^firestore_mutations_".concat(u,"_(\\d+)(?:_(.*))?$")),this.zs=new RegExp("^firestore_targets_".concat(u,"_(\\d+)$")),this.Hs=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Js=function(e){return"firestore_bundle_loaded_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}var t,n;return(0,d.Z)(e,[{key:"start",value:(n=(0,u.Z)(y().mark((function e(){var t,n,r,i,a,u,o,s,c,l,f,h=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.pn();case 2:t=e.sent,n=b(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.Ls){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Aa(this.persistenceKey,i)))&&(u=Ra.$s(i,a))&&(this.qs=this.qs.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.Ys(),(o=this.storage.getItem(this.Hs))&&(s=this.Xs(o))&&this.Zs(s),c=b(this.Ks);try{for(c.s();!(l=c.n()).done;)f=l.value,this.Us(f)}catch(d){c.e(d)}finally{c.f()}this.Ks=[],this.window.addEventListener("pagehide",(function(){return h.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(){return n.apply(this,arguments)})},{key:"writeSequenceNumber",value:function(e){this.setItem(this.Qs,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.ti(this.qs)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.qs.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.ei(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.ei(e,t,n),this.ni(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(Za(this.persistenceKey,e));if(n){var r=La.$s(e,n);r&&(t=r.state)}}return this.si.Fs(e),this.Ys(),t}},{key:"removeLocalQueryTarget",value:function(e){this.si.Ms(e),this.Ys()}},{key:"isLocalQueryTarget",value:function(e){return this.si.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Za(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.ii(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.ni(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.ri(e)}},{key:"notifyBundleLoaded",value:function(){this.oi()}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return D("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){D("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){D("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"Us",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(D("SharedClientState","EVENT",n.key,n.newValue),n.key===this.js)return void Z("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,u.Z)(y().mark((function e(){var r,i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=41;break}if(null===n.key){e.next=39;break}if(!t.Ws.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.ai(n.key),e.abrupt("return",t.ci(r,null));case 6:if(!(i=t.ui(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.ci(i.clientId,i));case 9:e.next=39;break;case 11:if(!t.Gs.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.hi(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.li(a));case 16:e.next=39;break;case 18:if(!t.zs.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.fi(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.di(u));case 23:e.next=39;break;case 25:if(n.key!==t.Hs){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.Xs(n.newValue))){e.next=30;break}return e.abrupt("return",t.Zs(o));case 30:e.next=39;break;case 32:if(n.key!==t.Qs){e.next=37;break}s=function(e){var t=Q.T;if(null!=e)try{var n=JSON.parse(e);F("number"==typeof n),t=n}catch(e){Z("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),s!==Q.T&&t.sequenceNumberHandler(s),e.next=39;break;case 37:if(n.key!==t.Js){e.next=39;break}return e.abrupt("return",t.syncEngine.wi());case 39:e.next=42;break;case 41:t.Ks.push(n);case 42:case"end":return e.stop()}}),e)}))))}}},{key:"si",get:function(){return this.qs.get(this.Ls)}},{key:"Ys",value:function(){this.setItem(this.js,this.si.Os())}},{key:"ei",value:function(e,t,n){var r=new Ca(this.currentUser,e,t,n),i=Da(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Os())}},{key:"ni",value:function(e){var t=Da(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"ri",value:function(e){var t={clientId:this.Ls,onlineState:e};this.storage.setItem(this.Hs,JSON.stringify(t))}},{key:"ii",value:function(e,t,n){var r=Za(this.persistenceKey,e),i=new La(e,t,n);this.setItem(r,i.Os())}},{key:"oi",value:function(){this.setItem(this.Js,"value-not-used")}},{key:"ai",value:function(e){var t=this.Ws.exec(e);return t?t[1]:null}},{key:"ui",value:function(e,t){var n=this.ai(e);return Ra.$s(n,t)}},{key:"hi",value:function(e,t){var n=this.Gs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ca.$s(new E(i),r,t)}},{key:"fi",value:function(e,t){var n=this.zs.exec(e),r=Number(n[1]);return La.$s(r,t)}},{key:"Xs",value:function(e){return Fa.$s(e)}},{key:"li",value:(t=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine._i(t.batchId,t.state,t.error));case 2:D("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"di",value:function(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}},{key:"ci",value:function(e,t){var n=this,r=t?this.qs.insert(e,t):this.qs.remove(e),i=this.ti(this.qs),a=this.ti(r),u=[],o=[];return a.forEach((function(e){i.has(e)||u.push(e)})),i.forEach((function(e){a.has(e)||o.push(e)})),this.syncEngine.gi(u,o).then((function(){n.qs=r}))}},{key:"Zs",value:function(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"ti",value:function(e){var t=wn();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"bt",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Va=function(){function e(){(0,h.Z)(this,e),this.yi=new Ma,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,d.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.yi.Fs(e),this.pi[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.pi[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.yi.Ms(e)}},{key:"isLocalQueryTarget",value:function(e){return this.yi.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.pi[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.yi.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.yi.activeTargetIds.has(e)}},{key:"start",value:function(){return this.yi=new Ma,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(){}}]),e}(),Pa=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"Ti",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),qa=function(){function e(){var t=this;(0,h.Z)(this,e),this.Ei=function(){return t.Ii()},this.Ai=function(){return t.Ri()},this.bi=[],this.Pi()}return(0,d.Z)(e,[{key:"Ti",value:function(e){this.bi.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}},{key:"Pi",value:function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}},{key:"Ii",value:function(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=b(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"Ri",value:function(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=b(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"bt",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),Ua={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ba=function(){function e(t){(0,h.Z)(this,e),this.vi=t.vi,this.Vi=t.Vi}return(0,d.Z)(e,[{key:"Si",value:function(e){this.Di=e}},{key:"Ci",value:function(e){this.Ni=e}},{key:"onMessage",value:function(e){this.xi=e}},{key:"close",value:function(){this.Vi()}},{key:"send",value:function(e){this.vi(e)}},{key:"ki",value:function(){this.Di()}},{key:"$i",value:function(e){this.Ni(e)}},{key:"Oi",value:function(e){this.xi(e)}}]),e}(),Ka=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return(0,d.Z)(n,[{key:"qi",value:function(e,t,n,r){return new Promise((function(i,a){var u=new w.JJ;u.listenOnce(w.tw.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case w.jK.NO_ERROR:var t=u.getResponseJson();D("Connection","XHR received:",JSON.stringify(t)),i(t);break;case w.jK.TIMEOUT:D("Connection",'RPC "'+e+'" timed out'),a(new P(V.DEADLINE_EXCEEDED,"Request time out"));break;case w.jK.HTTP_ERROR:var n=u.getStatus();if(D("Connection",'RPC "'+e+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var o=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(t)>=0?t:V.UNKNOWN}(r.status);a(new P(o,r.message))}else a(new P(V.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new P(V.UNAVAILABLE,"Connection failed."));break;default:R()}}finally{D("Connection",'RPC "'+e+'" completed.')}}));var o=JSON.stringify(r);u.send(t,"POST",o,n,15)}))}},{key:"ji",value:function(e,t){var n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=(0,w.UE)(),i=(0,w.FJ)(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new w.zI({})),this.Ui(a.initMessageHeaders,t),(0,k.uI)()||(0,k.b$)()||(0,k.d)()||(0,k.w1)()||(0,k.Mn)()||(0,k.ru)()||(a.httpHeadersOverwriteParam="$httpHeaders");var u=n.join("");D("Connection","Creating WebChannel: "+u,a);var o=r.createWebChannel(u,a),s=!1,c=!1,l=new Ba({vi:function(e){c?D("Connection","Not sending because WebChannel is closed:",e):(s||(D("Connection","Opening WebChannel transport."),o.open(),s=!0),D("Connection","WebChannel sending:",e),o.send(e))},Vi:function(){return o.close()}}),f=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return f(o,w.ii.EventType.OPEN,(function(){c||D("Connection","WebChannel transport opened.")})),f(o,w.ii.EventType.CLOSE,(function(){c||(c=!0,D("Connection","WebChannel transport closed"),l.$i())})),f(o,w.ii.EventType.ERROR,(function(e){c||(c=!0,C("Connection","WebChannel transport errored:",e),l.$i(new P(V.UNAVAILABLE,"The operation could not be completed")))})),f(o,w.ii.EventType.MESSAGE,(function(e){var t;if(!c){var n=e.data[0];F(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){D("Connection","WebChannel received error:",i);var a=i.status,u=function(e){var t=Xt[e];if(void 0!==t)return an(t)}(a),s=i.message;void 0===u&&(u=V.INTERNAL,s="Unknown error status: "+a+" with message "+i.message),c=!0,l.$i(new P(u,s)),o.close()}else D("Connection","WebChannel received:",n),l.Oi(n)}})),f(i,w.ju.STAT_EVENT,(function(e){e.stat===w.kN.PROXY?D("Connection","Detected buffering proxy"):e.stat===w.kN.NOPROXY&&D("Connection","Detected no buffering proxy")})),setTimeout((function(){l.ki()}),0),l}}]),n}(function(){function e(t){(0,h.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Fi=n+"://"+t.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return(0,d.Z)(e,[{key:"Li",value:function(e,t,n,r){var i=this.Bi(e,t);D("RestConnection","Sending: ",i,n);var a={};return this.Ui(a,r),this.qi(e,i,a,n).then((function(e){return D("RestConnection","Received: ",e),e}),(function(t){throw C("RestConnection","".concat(e," failed with error: "),t,"url: ",i,"request:",n),t}))}},{key:"Ki",value:function(e,t,n,r){return this.Li(e,t,n,r)}},{key:"Ui",value:function(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+S,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(var n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}},{key:"Bi",value:function(e,t){var n=Ua[e];return"".concat(this.Fi,"/v1/").concat(t,":").concat(n)}}]),e}());function za(){return"undefined"!=typeof window?window:null}function Ga(){return"undefined"!=typeof document?document:null}function ja(e){return new Cn(e,!0)}var Qa=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,h.Z)(this,e),this.Oe=t,this.timerId=n,this.Qi=r,this.Wi=i,this.Gi=a,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}return(0,d.Z)(e,[{key:"reset",value:function(){this.zi=0}},{key:"Yi",value:function(){this.zi=this.Gi}},{key:"Xi",value:function(e){var t=this;this.cancel();var n=Math.floor(this.zi+this.Zi()),r=Math.max(0,Date.now()-this.Ji),i=Math.max(0,n-r);i>0&&D("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.zi," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,i,(function(){return t.Ji=Date.now(),e()})),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}},{key:"tr",value:function(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}},{key:"cancel",value:function(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}},{key:"Zi",value:function(){return(Math.random()-.5)*this.zi}}]),e}(),Ha=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.Oe=t,this.er=r,this.nr=i,this.credentialsProvider=a,this.listener=u,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new Qa(t,n)}var t,n,r;return(0,d.Z)(e,[{key:"ar",value:function(){return 1===this.state||2===this.state||4===this.state}},{key:"cr",value:function(){return 2===this.state}},{key:"start",value:function(){3!==this.state?this.auth():this.ur()}},{key:"stop",value:(r=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.ar(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"hr",value:function(){this.state=0,this.rr.reset()}},{key:"lr",value:function(){var e=this;this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,(function(){return e.dr()})))}},{key:"wr",value:function(e){this._r(),this.stream.send(e)}},{key:"dr",value:(n=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cr()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_r",value:function(){this.ir&&(this.ir.cancel(),this.ir=null)}},{key:"close",value:(t=(0,u.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._r(),this.rr.cancel(),this.sr++,3!==t?this.rr.reset():n&&n.code===V.RESOURCE_EXHAUSTED?(Z(n.toString()),Z("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):n&&n.code===V.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=t,e.next=8,this.listener.Ci(n);case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"mr",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.gr(this.sr),n=this.sr;this.credentialsProvider.getToken().then((function(t){e.sr===n&&e.yr(t)}),(function(n){t((function(){var t=new P(V.UNKNOWN,"Fetching auth token failed: "+n.message);return e.pr(t)}))}))}},{key:"yr",value:function(e){var t=this,n=this.gr(this.sr);this.stream=this.Tr(e),this.stream.Si((function(){n((function(){return t.state=2,t.listener.Si()}))})),this.stream.Ci((function(e){n((function(){return t.pr(e)}))})),this.stream.onMessage((function(e){n((function(){return t.onMessage(e)}))}))}},{key:"ur",value:function(){var e=this;this.state=4,this.rr.Xi((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"pr",value:function(e){return D("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(3,e)}},{key:"gr",value:function(e){var t=this;return function(n){t.Oe.enqueueAndForget((function(){return t.sr===e?n():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),Wa=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a,u){var o;return(0,h.Z)(this,n),(o=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",r,i,u)).N=a,o}return(0,d.Z)(n,[{key:"Tr",value:function(e){return this.nr.ji("Listen",e)}},{key:"onMessage",value:function(e){this.rr.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:R()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.D?(F(void 0===t||"string"==typeof t),le.fromBase64String(t||"")):(F(void 0===t||t instanceof Uint8Array),le.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?V.UNKNOWN:an(e.code);return new P(t,e.message||"")}(u);n=new En(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=qn(e,s.document.name),l=Mn(s.document.updateTime),f=new Me({mapValue:{fields:s.document.fields}}),h=Ve.newFoundDocument(c,l,f),d=s.targetIds||[],v=s.removedTargetIds||[];n=new In(d,v,h.key,h)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var p=qn(e,y.document),m=y.readTime?Mn(y.readTime):ee.min(),g=Ve.newNoDocument(p,m),k=y.removedTargetIds||[];n=new In([],k,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=qn(e,w.document),x=w.removedTargetIds||[];n=new In([],x,b,null)}else{if(!("filter"in t))return R();t.filter;var I=t.filter;I.targetId;var T=I.count||0,E=new nn(T),S=I.targetId;n=new Tn(S,E)}return n}(this.N,e),n=function(e){if(!("targetChange"in e))return ee.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?ee.min():t.readTime?Mn(t.readTime):ee.min()}(e);return this.listener.Er(t,n)}},{key:"Ir",value:function(e){var t={};t.database=Kn(this.N),t.addTarget=function(e,t){var n,r=t.target;return(n=Ke(r)?{documents:Yn(e,r)}:{query:Jn(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Rn(e,t.resumeToken):t.snapshotVersion.compareTo(ee.min())>0&&(n.readTime=Ln(e,t.snapshotVersion.toTimestamp())),n}(this.N,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return R()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.N,e);n&&(t.labels=n),this.wr(t)}},{key:"Ar",value:function(e){var t={};t.database=Kn(this.N),t.removeTarget=e,this.wr(t)}}]),n}(Ha),Ya=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a,u){var o;return(0,h.Z)(this,n),(o=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",r,i,u)).N=a,o.Rr=!1,o}return(0,d.Z)(n,[{key:"br",get:function(){return this.Rr}},{key:"start",value:function(){this.Rr=!1,this.lastStreamToken=void 0,(0,i.Z)((0,c.Z)(n.prototype),"start",this).call(this)}},{key:"mr",value:function(){this.Rr&&this.Pr([])}},{key:"Tr",value:function(e){return this.nr.ji("Write",e)}},{key:"onMessage",value:function(e){if(F(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Rr){this.rr.reset();var t=function(e,t){return e&&e.length>0?(F(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Mn(e.updateTime):Mn(t);return n.isEqual(ee.min())&&(n=Mn(t)),new Vt(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Mn(e.commitTime);return this.listener.vr(n,t)}return F(!e.writeResults||0===e.writeResults.length),this.Rr=!0,this.listener.Vr()}},{key:"Sr",value:function(){var e={};e.database=Kn(this.N),this.wr(e)}},{key:"Pr",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return Hn(t.N,e)}))};this.wr(n)}}]),n}(Ha),Ja=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).credentials=e,a.nr=r,a.N=i,a.Dr=!1,a}return(0,d.Z)(n,[{key:"Cr",value:function(){if(this.Dr)throw new P(V.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Li",value:function(e,t,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.nr.Li(e,t,n,i)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===V.UNAUTHENTICATED&&r.credentials.invalidateToken(),e):new P(V.UNKNOWN,e.toString())}))}},{key:"Ki",value:function(e,t,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.nr.Ki(e,t,n,i)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===V.UNAUTHENTICATED&&r.credentials.invalidateToken(),e):new P(V.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.Dr=!0}}]),n}(function(){return function e(){(0,h.Z)(this,e)}}()),Xa=function(){function e(t,n){(0,h.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}return(0,d.Z)(e,[{key:"Or",value:function(){var e=this;0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.kr=null,e.Mr("Backend didn't respond within 10 seconds."),e.Fr("Offline"),Promise.resolve()})))}},{key:"Lr",value:function(e){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.Fr("Offline")))}},{key:"set",value:function(e){this.Br(),this.Nr=0,"Online"===e&&(this.$r=!1),this.Fr(e)}},{key:"Fr",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"Mr",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.$r?(Z(t),this.$r=!1):D("OnlineStateTracker",t)}},{key:"Br",value:function(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}]),e}(),$a=function e(t,n,r,i,a){var o=this;(0,h.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=a,this.Qr.Ti((function(e){r.enqueueAndForget((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=lu(o),!e.t0){e.next=5;break}return D("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=O(t)).Kr.add(4),e.next=4,nu(n);case 4:return n.Wr.set("Unknown"),n.Kr.delete(4),e.next=8,eu(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.Wr=new Xa(r,i)};function eu(e){return tu.apply(this,arguments)}function tu(){return(tu=(0,u.Z)(y().mark((function e(t){var n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!lu(t)){e.next=18;break}n=b(t.jr),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))).apply(this,arguments)}function nu(e){return ru.apply(this,arguments)}function ru(){return(ru=(0,u.Z)(y().mark((function e(t){var n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=b(t.jr),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}function iu(e,t){var n=O(e);n.qr.has(t.targetId)||(n.qr.set(t.targetId,t),cu(n)?su(n):Ou(n).cr()&&uu(n,t))}function au(e,t){var n=O(e),r=Ou(n);n.qr.delete(t),r.cr()&&ou(n,t),0===n.qr.size&&(r.cr()?r.lr():lu(n)&&n.Wr.set("Unknown"))}function uu(e,t){e.Gr.Y(t.targetId),Ou(e).Ir(t)}function ou(e,t){e.Gr.Y(t),Ou(e).Ar(t)}function su(e){e.Gr=new Nn({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},Tt:function(t){return e.qr.get(t)||null}}),Ou(e).start(),e.Wr.Or()}function cu(e){return lu(e)&&!Ou(e).ar()&&e.qr.size>0}function lu(e){return 0===O(e).Kr.size}function fu(e){e.Gr=void 0}function hu(e){return du.apply(this,arguments)}function du(){return(du=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.qr.forEach((function(e,n){uu(t,e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vu(e,t){return yu.apply(this,arguments)}function yu(){return(yu=(0,u.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fu(t),cu(t)?(t.Wr.Lr(n),su(t)):t.Wr.set("Unknown");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pu(e,t,n){return mu.apply(this,arguments)}function mu(){return mu=(0,u.Z)(y().mark((function e(t,n,r){var i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.Wr.set("Online"),!(n instanceof En&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=b(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.qr.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.qr.delete(u),t.Gr.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),D("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,gu(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof In?t.Gr.rt(n):n instanceof Tn?t.Gr.ft(n):t.Gr.ct(n),r.isEqual(ee.min())){e.next=29;break}return e.prev=14,e.next=17,ra(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Gr._t(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.qr.get(r);i&&e.qr.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.qr.get(t);if(n){e.qr.set(t,n.withResumeToken(le.EMPTY_BYTE_STRING,n.snapshotVersion)),ou(e,t);var r=new Qr(n.target,t,1,n.sequenceNumber);uu(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),D("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,gu(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),mu.apply(this,arguments)}function gu(e,t,n){return ku.apply(this,arguments)}function ku(){return(ku=(0,u.Z)(y().mark((function e(t,n,r){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Vr(n)){e.next=2;break}throw n;case 2:return t.Kr.add(1),e.next=5,nu(t);case 5:t.Wr.set("Offline"),r||(r=function(){return ra(t.localStore)}),t.asyncQueue.enqueueRetryable((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.Kr.delete(1),e.next=6,eu(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wu(e,t){return t().catch((function(n){return gu(e,n,t)}))}function bu(e){return xu.apply(this,arguments)}function xu(){return(xu=(0,u.Z)(y().mark((function e(t){var n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=O(t),r=Vu(n),i=n.Ur.length>0?n.Ur[n.Ur.length-1].batchId:-1;case 2:if(!Iu(n)){e.next=19;break}return e.prev=3,e.next=6,ua(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.Ur.length&&r.lr(),e.abrupt("break",19);case 10:i=a.batchId,Tu(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,gu(n,e.t0);case 17:e.next=2;break;case 19:Eu(n)&&Su(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}function Iu(e){return lu(e)&&e.Ur.length<10}function Tu(e,t){e.Ur.push(t);var n=Vu(e);n.cr()&&n.br&&n.Pr(t.mutations)}function Eu(e){return lu(e)&&!Vu(e).ar()&&e.Ur.length>0}function Su(e){Vu(e).start()}function Nu(e){return _u.apply(this,arguments)}function _u(){return(_u=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Vu(t).Sr();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Au(e){return Du.apply(this,arguments)}function Du(){return(Du=(0,u.Z)(y().mark((function e(t){var n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Vu(t),r=b(t.Ur);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Pr(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zu(e,t,n){return Cu.apply(this,arguments)}function Cu(){return(Cu=(0,u.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.Ur.shift(),a=jr.from(i,n,r),e.next=3,wu(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,bu(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lu(e,t){return Ru.apply(this,arguments)}function Ru(){return Ru=(0,u.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Vu(t).br,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!rn(i=n.code)||i===V.ABORTED){e.next=7;break}return r=t.Ur.shift(),Vu(t).hr(),e.next=5,wu(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,bu(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Eu(t)&&Su(t);case 5:case"end":return e.stop()}}),e)}))),Ru.apply(this,arguments)}function Fu(e,t){return Mu.apply(this,arguments)}function Mu(){return(Mu=(0,u.Z)(y().mark((function e(t,n){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),!n){e.next=7;break}return r.Kr.delete(2),e.next=5,eu(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.Kr.add(2),e.next=12,nu(r);case 12:r.Wr.set("Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ou(e){return e.zr||(e.zr=function(e,t,n){var r=O(e);return r.Cr(),new Wa(t,r.nr,r.credentials,r.N,n)}(e.datastore,e.asyncQueue,{Si:hu.bind(null,e),Ci:vu.bind(null,e),Er:pu.bind(null,e)}),e.jr.push(function(){var t=(0,u.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.zr.hr(),cu(e)?su(e):e.Wr.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.zr.stop();case 6:fu(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.zr}function Vu(e){return e.Hr||(e.Hr=function(e,t,n){var r=O(e);return r.Cr(),new Ya(t,r.nr,r.credentials,r.N,n)}(e.datastore,e.asyncQueue,{Si:Nu.bind(null,e),Ci:Lu.bind(null,e),Vr:Au.bind(null,e),vr:Zu.bind(null,e)}),e.jr.push(function(){var t=(0,u.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Hr.hr(),t.next=4,bu(e);case 4:t.next=9;break;case 6:return t.next=8,e.Hr.stop();case 8:e.Ur.length>0&&(D("RemoteStore","Stopping write stream with ".concat(e.Ur.length," pending writes")),e.Ur=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Hr}var Pu=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new q,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,d.Z)(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function qu(e,t){if(Z("AsyncQueue","".concat(t,": ").concat(e)),Vr(e))return new P(V.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var Uu=function(){function e(t){(0,h.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||be.comparator(e.key,n.key)}:function(e,t){return be.comparator(e.key,t.key)},this.keyedMap=vn(),this.sortedSet=new un(this.comparator)}return(0,d.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),Bu=function(){function e(){(0,h.Z)(this,e),this.Jr=new un(be.comparator)}return(0,d.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.Jr.get(t);n?0!==e.type&&3===n.type?this.Jr=this.Jr.insert(t,e):3===e.type&&1!==n.type?this.Jr=this.Jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jr=this.Jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jr=this.Jr.remove(t):1===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):R():this.Jr=this.Jr.insert(t,e)}},{key:"Yr",value:function(){var e=[];return this.Jr.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),Ku=function(){function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=s}return(0,d.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach((function(e){a.push({type:0,doc:e})})),new e(t,n,Uu.emptySet(n),a,r,i,!0,!1)}}]),e}(),zu=function e(){(0,h.Z)(this,e),this.Xr=void 0,this.listeners=[]},Gu=function e(){(0,h.Z)(this,e),this.queries=new Ri((function(e){return mt(e)}),pt),this.onlineState="Unknown",this.Zr=new Set};function ju(e,t){return Qu.apply(this,arguments)}function Qu(){return(Qu=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),i=n.query,a=!1,(u=r.queries.get(i))||(a=!0,u=new zu),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:u.Xr=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),o=qu(e.t0,"Initialization of query '".concat(gt(n.query),"' failed")),e.abrupt("return",void n.onError(o));case 13:r.queries.set(i,u),u.listeners.push(n),n.eo(r.onlineState),u.Xr&&n.no(u.Xr)&&Xu(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function Hu(e,t){return Wu.apply(this,arguments)}function Wu(){return(Wu=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),i=n.query,a=!1,(u=r.queries.get(i))&&(o=u.listeners.indexOf(n))>=0&&(u.listeners.splice(o,1),a=0===u.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yu(e,t){var n,r=O(e),i=!1,a=b(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=u.query,s=r.queries.get(o);if(s){var c,l=b(s.listeners);try{for(l.s();!(c=l.n()).done;){c.value.no(u)&&(i=!0)}}catch(f){l.e(f)}finally{l.f()}s.Xr=u}}}catch(f){a.e(f)}finally{a.f()}i&&Xu(r)}function Ju(e,t,n){var r=O(e),i=r.queries.get(t);if(i){var a,u=b(i.listeners);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(o){u.e(o)}finally{u.f()}}r.queries.delete(t)}function Xu(e){e.Zr.forEach((function(e){e.next()}))}var $u=function(){function e(t,n,r){(0,h.Z)(this,e),this.query=t,this.so=n,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=r||{}}return(0,d.Z)(e,[{key:"no",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=b(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new Ku(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.io?this.oo(e)&&(this.so.next(e),a=!0):this.ao(e,this.onlineState)&&(this.co(e),a=!0),this.ro=e,a}},{key:"onError",value:function(e){this.so.error(e)}},{key:"eo",value:function(e){this.onlineState=e;var t=!1;return this.ro&&!this.io&&this.ao(this.ro,e)&&(this.co(this.ro),t=!0),t}},{key:"ao",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return!(this.options.uo&&n||e.docs.isEmpty()&&"Offline"!==t)}},{key:"oo",value:function(e){if(e.docChanges.length>0)return!0;var t=this.ro&&this.ro.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"co",value:function(e){e=Ku.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.io=!0,this.so.next(e)}}]),e}(),eo=function(){function e(t,n){(0,h.Z)(this,e),this.payload=t,this.byteLength=n}return(0,d.Z)(e,[{key:"ho",value:function(){return"metadata"in this.payload}}]),e}(),to=function(){function e(t){(0,h.Z)(this,e),this.N=t}return(0,d.Z)(e,[{key:"zn",value:function(e){return qn(this.N,e)}},{key:"Hn",value:function(e){return e.metadata.exists?jn(this.N,e.document,!1):Ve.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}},{key:"Jn",value:function(e){return Mn(e)}}]),e}(),no=function(){function e(t,n,r){(0,h.Z)(this,e),this.lo=t,this.localStore=n,this.N=r,this.queries=[],this.documents=[],this.progress=ro(t)}var t;return(0,d.Z)(e,[{key:"fo",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"wo",value:function(e){var t,n=new Map,r=new to(this.N),i=b(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,o=r.zn(a.metadata.name),s=b(a.metadata.queries);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=(n.get(c)||gn()).add(o);n.set(c,l)}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:(t=(0,u.Z)(y().mark((function e(){var t,n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ya(this.localStore,new to(this.N),this.documents,this.lo.id);case 2:t=e.sent,n=this.wo(this.documents),r=b(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,ma(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",new Hi(Object.assign({},this.progress),t)));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])}))),function(){return t.apply(this,arguments)})}]),e}();function ro(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var io=function e(t){(0,h.Z)(this,e),this.key=t},ao=function e(t){(0,h.Z)(this,e),this.key=t},uo=function(){function e(t,n){(0,h.Z)(this,e),this.query=t,this._o=n,this.mo=null,this.current=!1,this.yo=gn(),this.mutatedKeys=gn(),this.po=wt(t),this.To=new Uu(this.po)}return(0,d.Z)(e,[{key:"Eo",get:function(){return this._o}},{key:"Io",value:function(e,t){var n=this,r=t?t.Ao:new Bu,i=t?t.To:this.To,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s=st(this.query)&&i.size===this.query.limit?i.last():null,c=ct(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),f=kt(n.query,t)?t:null,h=!!l&&n.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),v=!1;l&&f?l.data.isEqual(f.data)?h!==d&&(r.track({type:3,doc:f}),v=!0):n.Ro(l,f)||(r.track({type:2,doc:f}),v=!0,(s&&n.po(f,s)>0||c&&n.po(f,c)<0)&&(o=!0)):!l&&f?(r.track({type:0,doc:f}),v=!0):l&&!f&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(f?(u=u.add(f),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))})),st(this.query)||ct(this.query))for(;u.size>this.query.limit;){var l=st(this.query)?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{To:u,Ao:r,Ln:o,mutatedKeys:a}}},{key:"Ro",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.To;this.To=e.To,this.mutatedKeys=e.mutatedKeys;var a=e.Ao.Yr();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R()}};return n(e)-n(t)}(e.type,t.type)||r.po(e.doc,t.doc)})),this.bo(n);var u=t?this.Po():[],o=0===this.yo.size&&this.current?1:0,s=o!==this.mo;return this.mo=o,0!==a.length||s?{snapshot:new Ku(this.query,e.To,i,a,e.mutatedKeys,0===o,s,!1),vo:u}:{vo:u}}},{key:"eo",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({To:this.To,Ao:new Bu,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}},{key:"Vo",value:function(e){return!this._o.has(e)&&!!this.To.has(e)&&!this.To.get(e).hasLocalMutations}},{key:"bo",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t._o=t._o.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t._o=t._o.delete(e)})),this.current=e.current)}},{key:"Po",value:function(){var e=this;if(!this.current)return[];var t=this.yo;this.yo=gn(),this.To.forEach((function(t){e.Vo(t.key)&&(e.yo=e.yo.add(t.key))}));var n=[];return t.forEach((function(t){e.yo.has(t)||n.push(new ao(t))})),this.yo.forEach((function(e){t.has(e)||n.push(new io(e))})),n}},{key:"So",value:function(e){this._o=e.Gn,this.yo=gn();var t=this.Io(e.documents);return this.applyChanges(t,!0)}},{key:"Do",value:function(){return Ku.fromInitialDocuments(this.query,this.To,this.mutatedKeys,0===this.mo)}}]),e}(),oo=function e(t,n,r){(0,h.Z)(this,e),this.query=t,this.targetId=n,this.view=r},so=function e(t){(0,h.Z)(this,e),this.key=t,this.Co=!1},co=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.No={},this.xo=new Ri((function(e){return mt(e)}),pt),this.ko=new Map,this.$o=new Set,this.Oo=new un(be.comparator),this.Fo=new Map,this.Mo=new wa,this.Lo={},this.Bo=new Map,this.Uo=bi.ie(),this.onlineState="Unknown",this.qo=void 0}return(0,d.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.qo}}]),e}();function lo(e,t){return fo.apply(this,arguments)}function fo(){return(fo=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=is(t),!(u=r.xo.get(n))){e.next=6;break}i=u.targetId,r.sharedClientState.addLocalQueryTarget(i),a=u.view.Do(),e.next=15;break;case 6:return e.next=8,oa(r.localStore,vt(n));case 8:return o=e.sent,s=r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.targetId,e.next=13,ho(r,n,i,"current"===s);case 13:a=e.sent,r.isPrimaryClient&&iu(r.remoteStore,o);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ho(e,t,n,r){return vo.apply(this,arguments)}function vo(){return vo=(0,u.Z)(y().mark((function e(t,n,r,i){var a,o,s,c,l,f;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Ko=function(e,n,r){return(i=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Io(r),e.t0=a.Ln,!e.t0){e.next=6;break}return e.next=5,la(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.Io(t,a)}));case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=n.view.applyChanges(a,t.isPrimaryClient,u),e.abrupt("return",(Ro(t,n.targetId,o.vo),o.snapshot));case 8:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return i.apply(this,arguments)})(t,e,n,r);var i},e.next=3,la(t.localStore,n,!0);case 3:return a=e.sent,o=new uo(n,a.Gn),s=o.Io(a.documents),c=xn.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),l=o.applyChanges(s,t.isPrimaryClient,c),Ro(t,r,l.vo),f=new oo(n,r,o),e.abrupt("return",(t.xo.set(n,f),t.ko.has(r)?t.ko.get(r).push(n):t.ko.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}}),e)}))),vo.apply(this,arguments)}function yo(e,t){return po.apply(this,arguments)}function po(){return(po=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),i=r.xo.get(n),!((a=r.ko.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.ko.set(i.targetId,a.filter((function(e){return!pt(e,n)}))),void r.xo.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,sa(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),au(r.remoteStore,i.targetId),Co(r,i.targetId)})).catch(Si);case 9:e.next=14;break;case 11:return Co(r,i.targetId),e.next=14,sa(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mo(e,t,n){return go.apply(this,arguments)}function go(){return(go=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=as(t),e.prev=1,e.next=4,function(e,t){var n,r=O(e),i=$.now(),a=t.reduce((function(e,t){return e.add(t.key)}),gn());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(e){return r.Qn.Pn(e,a).next((function(a){n=a;var u,o=[],s=b(t);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=zt(c,n.get(c.key));null!=l&&o.push(new Ht(c.key,l,Oe(l.value.mapValue),Pt.exists(!0)))}}catch(f){s.e(f)}finally{s.f()}return r.In.addMutationBatch(e,i,o,t)}))})).then((function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Lo[e.currentUser.toKey()];r||(r=new un(Y)),r=r.insert(t,n),e.Lo[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,Oo(i,a.changes);case 9:return e.next=11,bu(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=qu(e.t0,"Failed to persist write"),r.reject(u);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function ko(e,t){return wo.apply(this,arguments)}function wo(){return(wo=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),e.prev=1,e.next=4,ia(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Fo.get(t);n&&(F(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.Co=!0:e.modifiedDocuments.size>0?F(n.Co):e.removedDocuments.size>0&&(F(n.Co),n.Co=!1))})),e.next=8,Oo(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Si(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function bo(e,t,n){var r=O(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.xo.forEach((function(e,n){var r=n.view.eo(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=O(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=b(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.eo(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}})),r&&Xu(n)}(r.eventManager,t),i.length&&r.No.Er(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function xo(e,t,n){return Io.apply(this,arguments)}function Io(){return(Io=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s,c;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=O(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Fo.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new un(be.comparator)).insert(u,Ve.newNoDocument(u,ee.min())),s=gn().add(u),c=new bn(ee.min(),new Map,new cn(Y),o,s),e.next=9,ko(i,c);case 9:i.Oo=i.Oo.remove(u),i.Fo.delete(n),Mo(i),e.next=16;break;case 14:return e.next=16,sa(i.localStore,n,!1).then((function(){return Co(i,n,r)})).catch(Si);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function To(e,t){return Eo.apply(this,arguments)}function Eo(){return(Eo=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=n.batch.batchId,e.prev=1,e.next=4,na(r.localStore,n);case 4:return a=e.sent,Zo(r,i,null),Do(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,Oo(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Si(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function So(e,t,n){return No.apply(this,arguments)}function No(){return(No=(0,u.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=O(t),e.prev=1,e.next=4,function(e,t){var n=O(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.In.lookupMutationBatch(e,t).next((function(t){return F(null!==t),r=t.keys(),n.In.removeMutationBatch(e,t)})).next((function(){return n.In.performConsistencyCheck(e)})).next((function(){return n.Qn.Pn(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,Zo(i,n,r),Do(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,Oo(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Si(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function _o(e,t){return Ao.apply(this,arguments)}function Ao(){return(Ao=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return lu((r=O(t)).remoteStore)||D("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=O(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.In.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.Bo.get(i)||[]).push(n),r.Bo.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=qu(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(u);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function Do(e,t){(e.Bo.get(t)||[]).forEach((function(e){e.resolve()})),e.Bo.delete(t)}function Zo(e,t,n){var r=O(e),i=r.Lo[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Lo[r.currentUser.toKey()]=i}}function Co(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=b(e.ko.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.xo.delete(a),n&&e.No.jo(a,n)}}catch(u){i.e(u)}finally{i.f()}e.ko.delete(t),e.isPrimaryClient&&e.Mo.cs(t).forEach((function(t){e.Mo.containsKey(t)||Lo(e,t)}))}function Lo(e,t){e.$o.delete(t.path.canonicalString());var n=e.Oo.get(t);null!==n&&(au(e.remoteStore,n),e.Oo=e.Oo.remove(t),e.Fo.delete(n),Mo(e))}function Ro(e,t,n){var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof io?(e.Mo.addReference(a.key,t),Fo(e,a)):a instanceof ao?(D("SyncEngine","Document no longer in limbo: "+a.key),e.Mo.removeReference(a.key,t),e.Mo.containsKey(a.key)||Lo(e,a.key)):R()}}catch(u){i.e(u)}finally{i.f()}}function Fo(e,t){var n=t.key,r=n.path.canonicalString();e.Oo.get(n)||e.$o.has(r)||(D("SyncEngine","New document in limbo: "+n),e.$o.add(r),Mo(e))}function Mo(e){for(;e.$o.size>0&&e.Oo.size<e.maxConcurrentLimboResolutions;){var t=e.$o.values().next().value;e.$o.delete(t);var n=new be(ae.fromString(t)),r=e.Uo.next();e.Fo.set(r,new so(n)),e.Oo=e.Oo.insert(n,r),iu(e.remoteStore,new Qr(vt(ot(n.path)),r,2,Q.T))}}function Oo(e,t,n){return Vo.apply(this,arguments)}function Vo(){return Vo=(0,u.Z)(y().mark((function e(t,n,r){var i,a,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=O(t),a=[],o=[],s=[],e.t0=i.xo.isEmpty(),e.t0){e.next=9;break}return i.xo.forEach((function(e,t){s.push(i.Ko(t,n,r).then((function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=Yi.kn(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(s);case 6:return i.No.Er(a),e.next=9,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s,c,l;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Lr.forEach(n,(function(t){return Lr.forEach(t.Nn,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return Lr.forEach(t.xn,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Vr(e.t0)){e.next=10;break}throw e.t0;case 10:D("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=b(n);try{for(i.s();!(a=i.n()).done;)u=a.value,o=u.targetId,u.fromCache||(s=r.Un.get(o),c=s.snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.Un=r.Un.insert(o,l))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),Vo.apply(this,arguments)}function Po(e,t){return qo.apply(this,arguments)}function qo(){return(qo=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=O(t)).currentUser.isEqual(n)){e.next=11;break}return D("SyncEngine","User change. New user:",n.toKey()),e.next=5,ea(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.Bo.forEach((function(e){e.forEach((function(e){e.reject(new P(V.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Bo.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,Oo(r,i.Wn);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Uo(e,t){var n=O(e),r=n.Fo.get(t);if(r&&r.Co)return gn().add(r.key);var i=gn(),a=n.ko.get(t);if(!a)return i;var u,o=b(a);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=n.xo.get(s);i=i.unionWith(c.view.Eo)}}catch(l){o.e(l)}finally{o.f()}return i}function Bo(e,t){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),e.next=3,la(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.So(i),e.abrupt("return",(r.isPrimaryClient&&Ro(r,n.targetId,a.vo),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zo(e){return Go.apply(this,arguments)}function Go(){return(Go=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O(t),e.abrupt("return",ha(n.localStore).then((function(e){return Oo(n,e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jo(e,t,n,r){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=O(t),e.next=3,function(e,t){var n=O(e),r=O(n.In);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Xt(e,t).next((function(t){return t?n.Qn.Pn(e,t):Lr.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,bu(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(Zo(a,n,i||null),Do(a,n),function(e,t){O(O(e).In).te(t)}(a.localStore,n)):R();case 11:return e.next=13,Oo(a,u);case 13:e.next=16;break;case 15:D("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ho(e,t){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s,c,l;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(is(r=O(t)),as(r),!0!==n||!0===r.qo){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,Yo(r,i.toArray());case 5:return a=e.sent,r.qo=!0,e.next=9,Fu(r.remoteStore,!0);case 9:u=b(a);try{for(u.s();!(o=u.n()).done;)s=o.value,iu(r.remoteStore,s)}catch(f){u.e(f)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.qo){e.next=25;break}return c=[],l=Promise.resolve(),r.ko.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?c.push(t):l=l.then((function(){return Co(r,t),sa(r.localStore,t,!0)})),au(r.remoteStore,t)})),e.next=19,l;case 19:return e.next=21,Yo(r,c);case 21:return function(e){var t=O(e);t.Fo.forEach((function(e,n){au(t.remoteStore,n)})),t.Mo.us(),t.Fo=new Map,t.Oo=new un(be.comparator)}(r),r.qo=!1,e.next=25,Fu(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yo(e,t,n){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s,c,l,f,h,d,v,p,m,g;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=O(t),a=[],u=[],o=b(n),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=45;break}if(c=s.value,l=void 0,!(f=i.ko.get(c))||0===f.length){e.next=34;break}return e.next=11,oa(i.localStore,vt(f[0]));case 11:l=e.sent,h=b(f),e.prev=13,h.s();case 15:if((d=h.n()).done){e.next=24;break}return v=d.value,p=i.xo.get(v),e.next=20,Bo(i,p);case 20:(m=e.sent).snapshot&&u.push(m.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),h.e(e.t0);case 29:return e.prev=29,h.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,fa(i.localStore,c);case 36:return g=e.sent,e.next=39,oa(i.localStore,g);case 39:return l=e.sent,e.next=42,ho(i,Xo(g),c,!1);case 42:a.push(l);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),o.e(e.t1);case 50:return e.prev=50,o.f(),e.finish(50);case 53:return e.abrupt("return",(i.No.Er(u),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])})))).apply(this,arguments)}function Xo(e){return ut(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function $o(e){var t=O(e);return O(O(t.localStore).persistence).pn()}function es(e,t,n,r){return ts.apply(this,arguments)}function ts(){return(ts=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=O(t)).qo){e.next=5;break}D("SyncEngine","Ignoring unexpected query state notification."),e.next=21;break;case 5:if(!a.ko.has(n)){e.next=21;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?9:"rejected"===e.t0?16:20;break;case 9:return e.next=11,ha(a.localStore);case 11:return u=e.sent,o=bn.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=15,Oo(a,u,o);case 15:return e.abrupt("break",21);case 16:return e.next=18,sa(a.localStore,n,!0);case 18:return Co(a,n,i),e.abrupt("break",21);case 20:R();case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ns(e,t,n){return rs.apply(this,arguments)}function rs(){return(rs=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s,c,l,f,h;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=is(t)).qo){e.next=45;break}a=b(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(o=u.value,!i.ko.has(o)){e.next=10;break}return D("SyncEngine","Adding an already active target "+o),e.abrupt("continue",19);case 10:return e.next=12,fa(i.localStore,o);case 12:return s=e.sent,e.next=15,oa(i.localStore,s);case 15:return c=e.sent,e.next=18,ho(i,Xo(s),c.targetId,!1);case 18:iu(i.remoteStore,c);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:l=b(r),e.prev=30,h=y().mark((function e(){var t;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.ko.has(t),!e.t0){e.next=5;break}return e.next=5,sa(i.localStore,t,!1).then((function(){au(i.remoteStore,t),Co(i,t)})).catch(Si);case 5:case"end":return e.stop()}}),e)})),l.s();case 33:if((f=l.n()).done){e.next=37;break}return e.delegateYield(h(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),l.e(e.t2);case 42:return e.prev=42,l.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])})))).apply(this,arguments)}function is(e){var t=O(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=ko.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Uo.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=xo.bind(null,t),t.No.Er=Yu.bind(null,t.eventManager),t.No.jo=Ju.bind(null,t.eventManager),t}function as(e){var t=O(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=To.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=So.bind(null,t),t}function us(e,t,n){var r,i=O(e);(r=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=O(e),r=Mn(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Je.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=10;break}return e.next=9,n.close();case 9:return e.abrupt("return",void r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)));case 10:return r._updateProgress(ro(i)),a=new no(i,t.localStore,n.N),e.next=14,n.Qo();case 14:u=e.sent;case 15:if(!u){e.next=25;break}return e.next=18,a.fo(u);case 18:return(o=e.sent)&&r._updateProgress(o),e.next=22,n.Qo();case 22:u=e.sent;case 23:e.next=15;break;case 25:return e.next=27,a.complete();case 27:return s=e.sent,e.next=30,Oo(t,s.En,void 0);case 30:return e.next=32,function(e,t){var n=O(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Je.saveBundleMetadata(e,t)}))}(t.localStore,i);case 32:r._completeWith(s.progress),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(0),C("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,35]])}))),function(e,t,n){return r.apply(this,arguments)})(i,t,n).then((function(){i.sharedClientState.notifyBundleLoaded()}))}var os=function(){function e(){(0,h.Z)(this,e),this.synchronizeTabs=!1}var t,n;return(0,d.Z)(e,[{key:"initialize",value:(n=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.N=ja(t.databaseInfo.databaseId),this.sharedClientState=this.Wo(t),this.persistence=this.Go(t),e.next=5,this.persistence.start();case 5:this.gcScheduler=this.zo(t),this.localStore=this.Ho(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"zo",value:function(e){return null}},{key:"Ho",value:function(e){return $i(this.persistence,new Ji,e.initialUser,this.N)}},{key:"Go",value:function(e){return new Sa(_a.Ns,this.N)}},{key:"Wo",value:function(e){return new Va}},{key:"terminate",value:(t=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ss=function(e){(0,o.Z)(r,e);var t,n=I(r);function r(e,t,i){var a;return(0,h.Z)(this,r),(a=n.call(this)).Jo=e,a.cacheSizeBytes=t,a.forceOwnership=i,a.synchronizeTabs=!1,a}return(0,d.Z)(r,[{key:"initialize",value:(t=(0,u.Z)(y().mark((function e(t){var n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,c.Z)(r.prototype),"initialize",this).call(this,t);case 2:return e.next=4,da(this.localStore);case 4:return e.next=6,this.Jo.initialize(this,t);case 6:return e.next=8,as(this.Jo.syncEngine);case 8:return e.next=10,bu(this.Jo.remoteStore);case 10:return e.next=12,this.persistence.nn((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Ho",value:function(e){return $i(this.persistence,new Ji,e.initialUser,this.N)}},{key:"zo",value:function(e){var t=this.persistence.referenceDelegate.garbageCollector;return new Di(t,e.asyncQueue)}},{key:"Go",value:function(e){var t=Qi(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?di.withCacheSize(this.cacheSizeBytes):di.DEFAULT;return new zi(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,za(),Ga(),this.N,this.sharedClientState,!!this.forceOwnership)}},{key:"Wo",value:function(e){return new Va}}]),r}(os),cs=function(e){(0,o.Z)(r,e);var t,n=I(r);function r(e,t){var i;return(0,h.Z)(this,r),(i=n.call(this,e,t,!1)).Jo=e,i.cacheSizeBytes=t,i.synchronizeTabs=!0,i}return(0,d.Z)(r,[{key:"initialize",value:(t=(0,u.Z)(y().mark((function e(t){var n,a=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,c.Z)(r.prototype),"initialize",this).call(this,t);case 2:if(n=this.Jo.syncEngine,e.t0=this.sharedClientState instanceof Oa,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={_i:jo.bind(null,n),mi:es.bind(null,n),gi:ns.bind(null,n),pn:$o.bind(null,n),wi:zo.bind(null,n)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.nn(function(){var e=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ho(a.Jo.syncEngine,t);case 2:a.gcScheduler&&(t&&!a.gcScheduler.started?a.gcScheduler.start(a.localStore):t||a.gcScheduler.stop());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Wo",value:function(e){var t=za();if(!Oa.bt(t))throw new P(V.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Qi(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Oa(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),r}(ss),ls=function(){function e(){(0,h.Z)(this,e)}var t;return(0,d.Z)(e,[{key:"initialize",value:(t=(0,u.Z)(y().mark((function e(t,n){var r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return bo(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Po.bind(null,this.syncEngine),e.next=12,Fu(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"createEventManager",value:function(e){return new Gu}},{key:"createDatastore",value:function(e){var t,n=ja(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new Ka(t));return function(e,t,n){return new Ja(e,t,n)}(e.credentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,u=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return bo(u.syncEngine,e,0)},a=qa.bt()?new qa:new Pa,new $a(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new co(e,t,n,r,i,a);return u&&(o.qo=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return(e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O(t),D("RemoteStore","RemoteStore shutting down."),n.Kr.add(5),e.next=5,nu(n);case 5:n.Qr.shutdown(),n.Wr.set("Unknown");case 7:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}();function fs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return(0,u.Z)(y().mark((function r(){var i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var hs=function(){function e(t){(0,h.Z)(this,e),this.observer=t,this.muted=!1}return(0,d.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.Yo(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Yo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"Xo",value:function(){this.muted=!0}},{key:"Yo",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),ds=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.Zo=t,this.N=n,this.metadata=new q,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then((function(e){e&&e.ho()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))}),(function(e){return r.metadata.reject(e)}))}var t,n,r,i,a,o;return(0,d.Z)(e,[{key:"close",value:function(){return this.Zo.cancel()}},{key:"getMetadata",value:(o=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"Qo",value:(a=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.ea());case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"ea",value:(i=(0,u.Z)(y().mark((function e(){var t,n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.na();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.ta.decode(t),r=Number(n),isNaN(r)&&this.sa("length string (".concat(n,") is not valid number")),e.next=9,this.ia(r);case 9:return i=e.sent,e.abrupt("return",new eo(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"ra",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"na",value:(r=(0,u.Z)(y().mark((function e(){var t,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.ra()<0)){e.next=7;break}return e.next=3,this.oa();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.ra())<0&&this.sa("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"ia",value:(n=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.oa();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.sa("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.ta.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sa",value:function(e){throw this.Zo.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"oa",value:(t=(0,u.Z)(y().mark((function e(){var t,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Zo.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),vs=function(){function e(t){(0,h.Z)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}var t,n;return(0,d.Z)(e,[{key:"lookup",value:(n=(0,u.Z)(y().mark((function e(t){var n,r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new P(V.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=Kn(r.N)+"/documents",a={documents:n.map((function(e){return Pn(r.N,e)}))},e.next=5,r.Ki("BatchGetDocuments",i,a);case 5:return u=e.sent,o=new Map,u.forEach((function(e){var t=Qn(r.N,e);o.set(t.key.toString(),t)})),s=[],e.abrupt("return",(n.forEach((function(e){var t=o.get(e.toString());F(!!t),s.push(t)})),s));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new en(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:(t=(0,u.Z)(y().mark((function e(){var t,n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=be.fromPath(t);n.mutations.push(new tn(r,n.precondition(r)))})),e.next=7,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=Kn(r.N)+"/documents",a={writes:n.map((function(e){return Hn(r.N,e)}))},e.next=3,r.Li("Commit",i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw R();t=ee.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new P(V.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Pt.updateTime(t):Pt.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ee.min()))throw new P(V.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Pt.updateTime(t)}return Pt.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),ys=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.aa=5,this.rr=new Qa(this.asyncQueue,"transaction_retry")}return(0,d.Z)(e,[{key:"run",value:function(){this.aa-=1,this.ca()}},{key:"ca",value:function(){var e=this;this.rr.Xi((0,u.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new vs(e.datastore),(r=e.ua(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.ha(t)}))}))})).catch((function(t){e.ha(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"ua",value:function(e){try{var t=this.updateFunction(e);return!ge(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"ha",value:function(e){var t=this;this.aa>0&&this.la(e)?(this.aa-=1,this.asyncQueue.enqueueAndForget((function(){return t.ca(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"la",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!rn(t)}return!1}}]),e}(),ps=function(){function e(t,n,r){var i=this;(0,h.Z)(this,e),this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=E.UNAUTHENTICATED,this.clientId=W.I(),this.credentialListener=function(){return Promise.resolve()},this.credentials.start(n,function(){var e=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D("FirestoreClient","Received user=",t.uid),e.next=3,i.credentialListener(t);case 3:i.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}var t;return(0,d.Z)(e,[{key:"getConfiguration",value:(t=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setCredentialChangeListener",value:function(e){this.credentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new P(V.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new q;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,u.Z)(y().mark((function n(){var r;return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.credentials.shutdown(),t.resolve(),n.next=17;break;case 13:n.prev=13,n.t2=n.catch(0),r=qu(n.t2,"Failed to shutdown persistence"),t.reject(r);case 17:case"end":return n.stop()}}),n,null,[[0,13]])})))),t.promise}}]),e}();function ms(e,t){return gs.apply(this,arguments)}function gs(){return gs=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,ea(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),gs.apply(this,arguments)}function ks(e,t){return ws.apply(this,arguments)}function ws(){return ws=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,bs(t);case 3:return r=e.sent,D("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return(t=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=O(t)).asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials"),i=lu(r),r.Kr.add(3),e.next=6,nu(r);case 6:return i&&r.Wr.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.Kr.delete(3),e.next=12,eu(r);case 12:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})(n.remoteStore,e);var t})),t.onlineComponents=n;case 12:case"end":return e.stop()}}),e)}))),ws.apply(this,arguments)}function bs(e){return xs.apply(this,arguments)}function xs(){return(xs=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return D("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,ms(t,new os);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Is(e){return Ts.apply(this,arguments)}function Ts(){return(Ts=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return D("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,ks(t,new ls);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Es(e){return bs(e).then((function(e){return e.persistence}))}function Ss(e){return bs(e).then((function(e){return e.localStore}))}function Ns(e){return Is(e).then((function(e){return e.remoteStore}))}function _s(e){return Is(e).then((function(e){return e.syncEngine}))}function As(e){return Ds.apply(this,arguments)}function Ds(){return(Ds=(0,u.Z)(y().mark((function e(t){var n,r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Is(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=lo.bind(null,n.syncEngine),r.onUnlisten=yo.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new hs({next:function(a){t.enqueueAndForget((function(){return Hu(e,u)}));var o=a.docs.has(n);!o&&a.fromCache?i.reject(new P(V.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&a.fromCache&&r&&"server"===r.source?i.reject(new P(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),u=new $u(ot(n.path),a,{includeMetadataChanges:!0,uo:!0});return ju(e,u)},i.next=3,As(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function Cs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new hs({next:function(n){t.enqueueAndForget((function(){return Hu(e,u)})),n.fromCache&&"server"===r.source?i.reject(new P(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new $u(n,a,{includeMetadataChanges:!0,uo:!0});return ju(e,u)},i.next=3,As(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}var Ls=function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.useFetchStreams=s},Rs=function(){function e(t,n){(0,h.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,d.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}]),e}(),Fs=new Map;function Ms(e,t,n){if(!n)throw new P(V.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Os(e,t,n,r){if(!0===t&&!0===r)throw new P(V.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function Vs(e){if(!be.isDocumentKey(e))throw new P(V.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Ps(e){if(be.isDocumentKey(e))throw new P(V.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function qs(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":R()}function Us(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new P(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=qs(e);throw new P(V.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function Bs(e,t){if(t<=0)throw new P(V.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var Ks=function(){function e(t){var n;if((0,h.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new P(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new P(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Os("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return(0,d.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),zs=function(){function e(t,n){(0,h.Z)(this,e),this._credentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ks({}),this._settingsFrozen=!1,t instanceof Rs?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new P(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rs(e.options.projectId)}(t))}return(0,d.Z)(e,[{key:"app",get:function(){if(!this._app)throw new P(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new P(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ks(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new B;switch(e.type){case"gapi":var t=e.client;return F(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new j(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new P(V.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return e=this,(t=Fs.get(e))&&(D("ComponentProvider","Removing Datastore"),Fs.delete(e),t.terminate()),Promise.resolve();var e,t}}]),e}();function Gs(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=Us(e,zs))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&C("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var u,o;if("string"==typeof i.mockUserToken)u=i.mockUserToken,o=E.MOCK_USER;else{u=(0,k.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new P(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new E(s)}e._credentials=new K(new U(u,o))}}var js=function(){function e(t,n,r){(0,h.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,d.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Hs(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Qs=function(){function e(t,n,r){(0,h.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,d.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Hs=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,ot(i)))._path=i,a.type="collection",a}return(0,d.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new js(this.firestore,null,new be(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(Qs);function Ws(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,k.m9)(e),Ms("collection","path",t),e instanceof zs){var a=ae.fromString.apply(ae,[t].concat(r));return Ps(a),new Hs(e,null,a)}if(!(e instanceof js||e instanceof Hs))throw new P(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(ae.fromString.apply(ae,[t].concat(r)));return Ps(u),new Hs(e.firestore,null,u)}function Ys(e,t){if(e=Us(e,zs),Ms("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new P(V.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new Qs(e,null,function(e){return new at(ae.emptyPath(),e)}(t))}function Js(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,k.m9)(e),1===arguments.length&&(t=W.I()),Ms("doc","path",t),e instanceof zs){var a=ae.fromString.apply(ae,[t].concat(r));return Vs(a),new js(e,null,new be(a))}if(!(e instanceof js||e instanceof Hs))throw new P(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(ae.fromString.apply(ae,[t].concat(r)));return Vs(u),new js(e.firestore,e instanceof Hs?e.converter:null,new be(u))}function Xs(e,t){return e=(0,k.m9)(e),t=(0,k.m9)(t),(e instanceof js||e instanceof Hs)&&(t instanceof js||t instanceof Hs)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function $s(e,t){return e=(0,k.m9)(e),t=(0,k.m9)(t),e instanceof Qs&&t instanceof Qs&&e.firestore===t.firestore&&pt(e._query,t._query)&&e.converter===t.converter}var ec=function(){function e(){var t=this;(0,h.Z)(this,e),this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new Qa(this,"async_queue_retry"),this.Ta=function(){var e=Ga();e&&D("AsyncQueue","Visibility state changed to "+e.visibilityState),t.rr.tr()};var n=Ga();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Ta)}var t,n;return(0,d.Z)(e,[{key:"isShuttingDown",get:function(){return this.wa}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Ea(),this.Ia(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.wa){this.wa=!0,this.ya=e||!1;var t=Ga();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ta)}}},{key:"enqueue",value:function(e){var t=this;if(this.Ea(),this.wa)return new Promise((function(){}));var n=new q;return this.Ia((function(){return t.wa&&t.ya?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.da.push(e),t.Aa()}))}},{key:"Aa",value:(n=(0,u.Z)(y().mark((function e(){var t=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.da.length){e.next=14;break}return e.prev=1,e.next=4,this.da[0]();case 4:this.da.shift(),this.rr.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Vr(e.t0)){e.next=12;break}throw e.t0;case 12:D("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.da.length>0&&this.rr.Xi((function(){return t.Aa()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return n.apply(this,arguments)})},{key:"Ia",value:function(e){var t=this,n=this.fa.then((function(){return t.ga=!0,e().catch((function(e){t.ma=e,t.ga=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Z("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.ga=!1,e}))}));return this.fa=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Ea(),this.pa.indexOf(e)>-1&&(t=0);var i=Pu.createAndSchedule(this,e,t,n,(function(e){return r.Ra(e)}));return this._a.push(i),i}},{key:"Ea",value:function(){this.ma&&R()}},{key:"verifyOperationInProgress",value:function(){}},{key:"ba",value:(t=(0,u.Z)(y().mark((function e(){var t;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.fa,e.next=3,t;case 3:if(t!==this.fa){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"Pa",value:function(e){var t,n=b(this._a);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"va",value:function(e){var t=this;return this.ba().then((function(){t._a.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=b(t._a);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.ba()}))}},{key:"Va",value:function(e){this.pa.push(e)}},{key:"Ra",value:function(e){var t=this._a.indexOf(e);this._a.splice(t,1)}}]),e}();function tc(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=b(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e)}var nc=function(){function e(){(0,h.Z)(this,e),this._progressObserver={},this._taskCompletionResolver=new q,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return(0,d.Z)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),rc=-1,ic=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,r)).type="firestore",i._queue=new ec,i._persistenceKey="name"in e?e.name:"[DEFAULT]",i}return(0,d.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||uc(this),this._firestoreClient.terminate()}}]),n}(zs);function ac(e){return e._firestoreClient||uc(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function uc(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new Ls(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new ps(e._credentials,e._queue,r)}function oc(e,t){pc(e=Us(e,ic));var n=ac(e),r=e._freezeSettings(),i=new ls;return cc(n,i,new ss(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function sc(e){pc(e=Us(e,ic));var t=ac(e),n=e._freezeSettings(),r=new ls;return cc(t,r,new cs(r,n.cacheSizeBytes))}function cc(e,t,n){var r=new q;return e.asyncQueue.enqueue((0,u.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,ms(e,n);case 3:return i.next=5,ks(e,t);case 5:r.resolve(),i.next=13;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===V.FAILED_PRECONDITION||e.code===V.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i.t0)){i.next=12;break}throw i.t0;case 12:console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i.t0),r.reject(i.t0);case 13:case"end":return i.stop()}}),i,null,[[0,8]])})))).then((function(){return r.promise}))}function lc(e){if(e._initialized&&!e._terminated)throw new P(V.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new q;return e._queue.enqueueAndForgetEvenWhileRestricted((0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Fr.bt()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Fr.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(Qi(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}function fc(e){return function(e){var t=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=_o,n.next=3,_s(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(ac(e=Us(e,ic)))}function hc(e){return function(e){return e.asyncQueue.enqueue((0,u.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Es(e);case 2:return n=t.sent,t.next=5,Ns(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=O(e);return t.Kr.delete(0),eu(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(ac(e=Us(e,ic)))}function dc(e){return function(e){return e.asyncQueue.enqueue((0,u.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Es(e);case 2:return n=t.sent,t.next=5,Ns(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=O(t)).Kr.add(0),e.next=4,nu(n);case 4:n.Wr.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(ac(e=Us(e,ic)))}function vc(e,t){var n=ac(e=Us(e,ic)),r=new nc;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new ds(e,t)}(function(e,t){if(e instanceof Uint8Array)return fs(e,t);if(e instanceof ArrayBuffer)return fs(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,ja(t));e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=us,t.next=3,_s(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function yc(e,t){return function(e,t){return e.asyncQueue.enqueue((0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=O(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Je.getNamedQuery(e,t)}))},n.next=3,Ss(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(ac(e=Us(e,ic)),t).then((function(t){return t?new Qs(e,null,t.query):null}))}function pc(e){if(e._initialized||e._terminated)throw new P(V.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var mc=function(){function e(){(0,h.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new P(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oe(n)}return(0,d.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();var gc=function(){function e(t){(0,h.Z)(this,e),this._byteString=t}return(0,d.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(le.fromBase64String(t))}catch(t){throw new P(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(le.fromUint8Array(t))}}]),e}(),kc=function e(t){(0,h.Z)(this,e),this._methodName=t},wc=function(){function e(t,n){if((0,h.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new P(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new P(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,d.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return Y(this._lat,e._lat)||Y(this._long,e._long)}}]),e}(),bc=/^__.*__$/,xc=function(){function e(t,n,r){(0,h.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,d.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new Ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qt(e,this.data,t,this.fieldTransforms)}}]),e}(),Ic=function(){function e(t,n,r){(0,h.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,d.Z)(e,[{key:"toMutation",value:function(e,t){return new Ht(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function Tc(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R()}}var Ec=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.settings=t,this.databaseId=n,this.N=r,this.ignoreUndefinedProperties=i,void 0===a&&this.Sa(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return(0,d.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"Da",get:function(){return this.settings.Da}},{key:"Ca",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Na",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.ka(e),r}},{key:"$a",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.Sa(),r}},{key:"Oa",value:function(e){return this.Ca({path:void 0,xa:!0})}},{key:"Fa",value:function(e){return Gc(e,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"Sa",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.ka(this.path.get(e))}},{key:"ka",value:function(e){if(0===e.length)throw this.Fa("Document fields must not be empty");if(Tc(this.Da)&&bc.test(e))throw this.Fa('Document fields cannot begin and end with "__"')}}]),e}(),Sc=function(){function e(t,n,r){(0,h.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.N=r||ja(t)}return(0,d.Z)(e,[{key:"Ba",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Ec({Da:e,methodName:t,La:n,path:oe.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}]),e}();function Nc(e){var t=e._freezeSettings(),n=ja(e._databaseId);return new Sc(e._databaseId,!!t.ignoreUndefinedProperties,n)}function _c(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.Ba(a.merge||a.mergeFields?2:0,t,n,i);Uc("Data must be an object, but it was:",u,r);var o,s,c=Pc(r,u);if(a.merge)o=new se(u.fieldMask),s=u.fieldTransforms;else if(a.mergeFields){var l,f=[],h=b(a.mergeFields);try{for(h.s();!(l=h.n()).done;){var d=l.value,v=Bc(t,d,n);if(!u.contains(v))throw new P(V.INVALID_ARGUMENT,"Field '".concat(v,"' is specified in your field mask but missing from your input data."));jc(f,v)||f.push(v)}}catch(y){h.e(y)}finally{h.f()}o=new se(f),s=u.fieldTransforms.filter((function(e){return o.covers(e.field)}))}else o=null,s=u.fieldTransforms;return new xc(new Me(c),o,s)}var Ac=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.Da)throw 1===e.Da?e.Fa("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Fa("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(kc);function Dc(e,t,n){return new Ec({Da:3,La:t.settings.La,methodName:e._methodName,xa:n},t.databaseId,t.N,t.ignoreUndefinedProperties)}var Zc=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){return new Ot(e.path,new At)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(kc),Cc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Ua=r,i}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Dc(this,e,!0),n=this.Ua.map((function(e){return Vc(e,t)})),r=new Dt(n);return new Ot(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(kc),Lc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Ua=r,i}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Dc(this,e,!0),n=this.Ua.map((function(e){return Vc(e,t)})),r=new Ct(n);return new Ot(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(kc),Rc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).qa=r,i}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new Rt(e.N,Tt(e.N,this.qa));return new Ot(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(kc);function Fc(e,t,n,r){var i=e.Ba(1,t,n);Uc("Data must be an object, but it was:",i,r);var a=[],u=Me.empty();ne(r,(function(e,r){var o=zc(t,e,n);r=(0,k.m9)(r);var s=i.$a(o);if(r instanceof Ac)a.push(o);else{var c=Vc(r,s);null!=c&&(a.push(o),u.set(o,c))}}));var o=new se(a);return new Ic(u,o,i.fieldTransforms)}function Mc(e,t,n,r,i,a){var u=e.Ba(1,t,n),o=[Bc(t,r,n)],s=[i];if(a.length%2!=0)throw new P(V.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)o.push(Bc(t,a[c])),s.push(a[c+1]);for(var l=[],f=Me.empty(),h=o.length-1;h>=0;--h)if(!jc(l,o[h])){var d=o[h],v=s[h];v=(0,k.m9)(v);var y=u.$a(d);if(v instanceof Ac)l.push(d);else{var p=Vc(v,y);null!=p&&(l.push(d),f.set(d,p))}}var m=new se(l);return new Ic(f,m,u.fieldTransforms)}function Oc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Vc(n,e.Ba(r?4:3,t))}function Vc(e,t){if(qc(e=(0,k.m9)(e)))return Uc("Unsupported field value:",t,e),Pc(e,t);if(e instanceof kc)return function(e,t){if(!Tc(t.Da))throw t.Fa("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Fa("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xa&&4!==t.Da)throw t.Fa("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=b(e);try{for(a.s();!(n=a.n()).done;){var u=Vc(n.value,t.Oa(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,k.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Tt(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=$.fromDate(e);return{timestampValue:Ln(t.N,n)}}if(e instanceof $){var r=new $(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ln(t.N,r)}}if(e instanceof wc)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof gc)return{bytesValue:Rn(t.N,e._byteString)};if(e instanceof js){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.Fa("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:On(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Fa("Unsupported field value: ".concat(qs(e)))}(e,t)}function Pc(e,t){var n={};return re(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ne(e,(function(e,r){var i=Vc(r,t.Na(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function qc(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof $||e instanceof wc||e instanceof gc||e instanceof js||e instanceof kc)}function Uc(e,t,n){if(!qc(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=qs(n);throw"an object"===r?t.Fa(e+" a custom object"):t.Fa(e+" "+r)}}function Bc(e,t,n){if((t=(0,k.m9)(t))instanceof mc)return t._internalPath;if("string"==typeof t)return zc(e,t);throw Gc("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var Kc=new RegExp("[~\\*/\\[\\]]");function zc(e,t,n){if(t.search(Kc)>=0)throw Gc("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,r.Z)(mc,(0,f.Z)(t.split(".")))._internalPath}catch(i){throw Gc("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Gc(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";var s="";return(a||u)&&(s+=" (found",a&&(s+=" in field ".concat(r)),u&&(s+=" in document ".concat(i)),s+=")"),new P(V.INVALID_ARGUMENT,o+e+s)}function jc(e,t){return e.some((function(e){return e.isEqual(t)}))}var Qc=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,d.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new js(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new Hc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(Wc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),Hc=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"data",value:function(){return(0,i.Z)((0,c.Z)(n.prototype),"data",this).call(this)}}]),n}(Qc);function Wc(e,t){return"string"==typeof t?zc(e,t):t instanceof mc?t._internalPath:t._delegate._internalPath}var Yc=function(){function e(t,n){(0,h.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,d.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),Jc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a,u,o){var s;return(0,h.Z)(this,n),(s=t.call(this,e,r,i,a,o))._firestore=e,s._firestoreImpl=e,s.metadata=u,s}return(0,d.Z)(n,[{key:"exists",value:function(){return(0,i.Z)((0,c.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new Xc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(Wc("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(Qc),Xc=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)((0,c.Z)(n.prototype),"data",this).call(this,e)}}]),n}(Jc),$c=function(){function e(t,n,r,i){(0,h.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new Yc(i.hasPendingWrites,i.fromCache),this.query=r}return(0,d.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new Xc(n._firestore,n._userDataWriter,r.key,r,new Yc(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new Xc(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Yc(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new Xc(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Yc(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:el(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function el(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R()}}function tl(e,t){return e instanceof Jc&&t instanceof Jc?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof $c&&t instanceof $c&&e._firestore===t._firestore&&$s(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function nl(e){if(ct(e)&&0===e.explicitOrderBy.length)throw new P(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var rl=function e(){(0,h.Z)(this,e)};function il(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=u._apply(e)}return e}var al=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).Ka=e,a.ja=r,a.Qa=i,a.type="where",a}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=Nc(e.firestore),n=function(e,t,n,r,i,a,u){var o;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new P(V.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on FieldPath.documentId()."));if("in"===a||"not-in"===a){wl(u,a);var s,c=[],l=b(u);try{for(l.s();!(s=l.n()).done;){var f=s.value;c.push(kl(r,e,f))}}catch(d){l.e(d)}finally{l.f()}o={arrayValue:{values:c}}}else o=kl(r,e,u)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||wl(u,a),o=Oc(n,"where",u,"in"===a||"not-in"===a);var h=ze.create(i,a,o);return function(e,t){if(t.v()){var n=ft(e);if(null!==n&&!n.isEqual(t.field))throw new P(V.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=lt(e);null!==r&&bl(e,t.field,r)}var i=function(e,t){var n,r=b(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(d){r.e(d)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw i===t.op?new P(V.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new P(V.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,h),h}(e._query,0,t,e.firestore._databaseId,this.Ka,this.ja,this.Qa);return new Qs(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new at(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}(rl);function ul(e,t,n){var r=t,i=Wc("where",e);return new al(i,r,n)}var ol=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).Ka=e,i.Wa=r,i.type="orderBy",i}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new P(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new P(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new tt(t,n);return function(e,t){if(null===lt(e)){var n=ft(e);null!==n&&bl(e,n,t.field)}}(e,r),r}(e._query,this.Ka,this.Wa);return new Qs(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new at(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}(rl);function sl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=t,r=Wc("orderBy",e);return new ol(r,n)}var cl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Ga=r,a.za=i,a}return(0,d.Z)(n,[{key:"_apply",value:function(e){return new Qs(e.firestore,e.converter,yt(e._query,this.Ga,this.za))}}]),n}(rl);function ll(e){return Bs("limit",e),new cl("limit",e,"F")}function fl(e){return Bs("limitToLast",e),new cl("limitToLast",e,"L")}var hl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Ha=r,a.Ja=i,a}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=gl(e,this.type,this.Ha,this.Ja);return new Qs(e.firestore,e.converter,function(e,t){return new at(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}(rl);function dl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new hl("startAt",t,!0)}function vl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new hl("startAfter",t,!1)}var yl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Ha=r,a.Ja=i,a}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=gl(e,this.type,this.Ha,this.Ja);return new Qs(e.firestore,e.converter,function(e,t){return new at(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}(rl);function pl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new yl("endBefore",t,!0)}function ml(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new yl("endAt",t,!1)}function gl(e,t,n,r){if(n[0]=(0,k.m9)(n[0]),n[0]instanceof Qc)return function(e,t,n,r,i){if(!r)throw new P(V.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,u=[],o=b(dt(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.field.isKeyField())u.push(Ae(t,r.key));else{var c=r.data.field(s.field);if(ye(c))throw new P(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=s.field.canonicalString();throw new P(V.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(l,"' (used as the orderBy) does not exist."))}u.push(c)}}}catch(f){o.e(f)}finally{o.f()}return new $e(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Nc(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new P(V.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if("string"!=typeof c)throw new P(V.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!ht(e)&&-1!==c.indexOf("/"))throw new P(V.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(ae.fromString(c));if(!be.isDocumentKey(l))throw new P(V.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var f=new be(l);o.push(Ae(t,f))}else{var h=Oc(n,r,c);o.push(h)}}return new $e(o,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function kl(e,t,n){if("string"==typeof(n=(0,k.m9)(n))){if(""===n)throw new P(V.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ht(t)&&-1!==n.indexOf("/"))throw new P(V.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(ae.fromString(n));if(!be.isDocumentKey(r))throw new P(V.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Ae(e,new be(r))}if(n instanceof js)return Ae(e,n._key);throw new P(V.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(qs(n),"."))}function wl(e,t){if(!Array.isArray(e)||0===e.length)throw new P(V.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new P(V.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function bl(e,t,n){if(!n.isEqual(t))throw new P(V.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var xl=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(xe(e)){case 0:return null;case 1:return e.booleanValue;case 2:return de(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ve(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw R()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return ne(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new wc(de(e.latitude),de(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=pe(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(me(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=he(e);return new $(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=ae.fromString(e);F(cr(n));var r=new Rs(n.get(1),n.get(3)),i=new be(n.popFirst(5));return r.isEqual(t)||Z("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function Il(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Tl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,d.Z)(n,[{key:"convertBytes",value:function(e){return new gc(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new js(this.firestore,null,t)}}]),n}(xl),El=function(){function e(t,n){(0,h.Z)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Nc(t)}return(0,d.Z)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=Sl(e,this._firestore),i=Il(r.converter,t,n),a=_c(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Pt.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=Sl(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,k.m9)(t))||t instanceof mc?Mc(this._dataReader,"WriteBatch.update",i._key,t,n,u):Fc(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Pt.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=Sl(e,this._firestore);return this._mutations=this._mutations.concat(new en(t._key,Pt.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new P(V.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function Sl(e,t){if((e=(0,k.m9)(e)).firestore!==t)throw new P(V.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Nl(e){e=Us(e,js);var t=Us(e.firestore,ic);return Zs(ac(t),e._key).then((function(n){return Ul(t,e,n)}))}var _l=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,d.Z)(n,[{key:"convertBytes",value:function(e){return new gc(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new js(this.firestore,null,t)}}]),n}(xl);function Al(e){e=Us(e,js);var t=Us(e.firestore,ic),n=ac(t),r=new _l(t);return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,u.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=O(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.Qn.An(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new P(V.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=qu(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Ss(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new Jc(t,r,e._key,n,new Yc(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function Dl(e){e=Us(e,js);var t=Us(e.firestore,ic);return Zs(ac(t),e._key,{source:"server"}).then((function(n){return Ul(t,e,n)}))}function Zl(e){e=Us(e,Qs);var t=Us(e.firestore,ic),n=ac(t),r=new _l(t);return nl(e._query),Cs(n,e._query).then((function(n){return new $c(t,r,e,n)}))}function Cl(e){e=Us(e,Qs);var t=Us(e.firestore,ic),n=ac(t),r=new _l(t);return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,la(t,n,!0);case 3:i=e.sent,a=new uo(n,i.Gn),u=a.Io(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=qu(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Ss(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new $c(t,r,e,n)}))}function Ll(e){e=Us(e,Qs);var t=Us(e.firestore,ic),n=ac(t),r=new _l(t);return Cs(n,e._query,{source:"server"}).then((function(n){return new $c(t,r,e,n)}))}function Rl(e,t,n){e=Us(e,js);var r=Us(e.firestore,ic),i=Il(e.converter,t,n);return ql(r,[_c(Nc(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Pt.none())])}function Fl(e,t,n){e=Us(e,js);for(var r=Us(e.firestore,ic),i=Nc(r),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return ql(r,[("string"==typeof(t=(0,k.m9)(t))||t instanceof mc?Mc(i,"updateDoc",e._key,t,n,u):Fc(i,"updateDoc",e._key,t)).toMutation(e._key,Pt.exists(!0))])}function Ml(e){return ql(Us(e.firestore,ic),[new en(e._key,Pt.none())])}function Ol(e,t){var n=Us(e.firestore,ic),r=Js(e),i=Il(e.converter,t);return ql(n,[_c(Nc(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Pt.exists(!1))]).then((function(){return r}))}function Vl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=(0,k.m9)(e);var s={includeMetadataChanges:!1},c=0;"object"!=typeof n[c]||tc(n[c])||(s=n[c],c++);var l,f,h,d={includeMetadataChanges:s.includeMetadataChanges};if(tc(n[c])){var v=n[c];n[c]=null===(i=v.next)||void 0===i?void 0:i.bind(v),n[c+1]=null===(a=v.error)||void 0===a?void 0:a.bind(v),n[c+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof js)f=Us(e.firestore,ic),h=ot(e._key.path),l={next:function(t){n[c]&&n[c](Ul(f,e,t))},error:n[c+1],complete:n[c+2]};else{var p=Us(e,Qs);f=Us(p.firestore,ic),h=p._query;var m=new _l(f);l={next:function(e){n[c]&&n[c](new $c(f,m,p,e))},error:n[c+1],complete:n[c+2]},nl(e._query)}return function(e,t,n,r){var i=new hs(r),a=new $u(t,i,n);return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=ju,t.next=3,As(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.Xo(),e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Hu,t.next=3,As(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(ac(f),h,d,l)}function Pl(e,t){return function(e,t){var n=new hs(t);return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){O(e).Zr.add(t),t.next()},t.next=3,As(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.Xo(),e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){O(e).Zr.delete(t)},t.next=3,As(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(ac(e=Us(e,ic)),tc(t)?t:{next:t})}function ql(e,t){return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=mo,r.next=3,_s(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(ac(e),t)}function Ul(e,t,n){var r=n.docs.get(t._key),i=new _l(e);return new Jc(e,i,t._key,r,new Yc(n.hasPendingWrites,n.fromCache),t.converter)}var Bl,Kl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,r))._firestore=e,i}return(0,d.Z)(n,[{key:"get",value:function(e){var t=this,r=Sl(e,this._firestore),a=new _l(this._firestore);return(0,i.Z)((0,c.Z)(n.prototype),"get",this).call(this,e).then((function(e){return new Jc(t._firestore,a,r._key,e._document,new Yc(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){(0,h.Z)(this,e),this._firestore=t,this._transaction=n,this._dataReader=Nc(t)}return(0,d.Z)(e,[{key:"get",value:function(e){var t=this,n=Sl(e,this._firestore),r=new Tl(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return R();var i=e[0];if(i.isFoundDocument())return new Qc(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Qc(t._firestore,r,n._key,null,n.converter);throw R()}))}},{key:"set",value:function(e,t,n){var r=Sl(e,this._firestore),i=Il(r.converter,t,n),a=_c(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=Sl(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,k.m9)(t))||t instanceof mc?Mc(this._dataReader,"Transaction.update",i._key,t,n,u):Fc(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=Sl(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function zl(e,t){return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){var i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,function(e){return Is(e).then((function(e){return e.datastore}))}(e);case 2:i=r.sent,new ys(e.asyncQueue,i,t,n).run();case 4:case"end":return r.stop()}}),r)})))),n.promise}(ac(e),(function(n){return t(new Kl(e,n))}))}function Gl(){return new Ac("deleteField")}function jl(){return new Zc("serverTimestamp")}function Ql(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Cc("arrayUnion",t)}function Hl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Lc("arrayRemove",t)}function Wl(e){return new Rc("increment",e)}Bl=p.SDK_VERSION,S=Bl,(0,p._registerComponent)(new m.wA("firestore",(function(e,t){var n=t.options,r=e.getProvider("app").getImmediate(),i=new ic(r,new z(e.getProvider("auth-internal")));return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i}),"PUBLIC")),(0,p.registerVersion)(T,"3.1.1",undefined),(0,p.registerVersion)(T,"3.1.1","esm2017")}}]);
//# sourceMappingURL=7112840a-0a09847fb5fd450c5358.js.map